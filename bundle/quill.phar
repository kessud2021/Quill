<?php
/**
 * Quill Framework - Bundled Distribution
 * Generated: 2026-01-16T07:59:21.807Z
 * Total Files: 93
 */



// ============================================
// File: bootstrap\app.php
// ============================================

// Define base path
define('BASE_PATH', dirname(__DIR__));

// Autoload
require BASE_PATH . '/vendor/autoload.php';

// Create container
$container = new \Framework\Container\Container();

// Store in global
$GLOBALS['__app'] = $container;

// Load environment variables
$dotenv = new \Framework\Env\DotEnv(BASE_PATH . '/.env');
$dotenv->load();

// Load configuration
$config = new \Framework\Config\Config();

$appConfig = \Framework\Config\Config::load(BASE_PATH . '/config/app.php');
$databaseConfig = \Framework\Config\Config::load(BASE_PATH . '/config/database.php');
$authConfig = \Framework\Config\Config::load(BASE_PATH . '/config/auth.php');

// Merge all configs
$allConfig = [
    'app' => $appConfig,
    'database' => $databaseConfig,
    'auth' => $authConfig,
];

$config = new \Framework\Config\Config($allConfig);

// Register services
$container->singleton(\Framework\Config\Config::class, $config);

// Database
$container->singleton(\Framework\Database\Manager::class, function ($app) {
    return new \Framework\Database\Manager($app[\Framework\Config\Config::class]);
});

// HTTP
$container->singleton(\Framework\Http\Request::class, function () {
    return new \Framework\Http\Request();
});

// Routing
$container->singleton(\Framework\Routing\Router::class, function () {
    return new \Framework\Routing\Router();
});

// View
$container->singleton(\Framework\View\View::class, function () {
    return new \Framework\View\View();
});

// Session
$container->singleton(\Framework\Session\Manager::class, function () {
    return new \Framework\Session\Manager();
});

// Auth
$container->singleton(\Framework\Auth\AuthManager::class, function ($app) {
    return new \Framework\Auth\AuthManager();
});

// Logging
$container->singleton(\Framework\Logging\Logger::class, function () {
    return new \Framework\Logging\Logger();
});

// Security
$container->singleton(\Framework\Security\Csrf::class, function () {
    return new \Framework\Security\Csrf();
});

// Load routes
require BASE_PATH . '/routes/web.php';

return $container;

// ============================================
// File: config\app.php
// ============================================

return [
    'name' => env('APP_NAME', 'Quill'),
    'env' => env('APP_ENV', 'local'),
    'debug' => env('APP_DEBUG', false),
    'url' => env('APP_URL', 'http://localhost:8000'),

    'timezone' => 'UTC',
    'charset' => 'UTF-8',

    'providers' => [
        // Service providers
    ],

    'aliases' => [
        // Class aliases
    ],
];

// ============================================
// File: config\auth.php
// ============================================

return [
    'default' => env('AUTH_GUARD', 'web'),

    'guards' => [
        'web' => [
            'driver' => 'session',
            'provider' => 'users',
        ],

        'api' => [
            'driver' => 'token',
            'provider' => 'users',
        ],
    ],

    'providers' => [
        'users' => [
            'driver' => 'database',
            'model' => 'App\\Models\\User',
            'table' => 'users',
        ],
    ],

    'passwords' => [
        'users' => [
            'provider' => 'users',
            'table' => 'password_resets',
            'expire' => 60,
        ],
    ],
];

// ============================================
// File: config\cache.php
// ============================================

return [
    'default' => env('CACHE_DRIVER', 'file'),

    'drivers' => [
        'file' => [
            'driver' => 'file',
            'path' => STORAGE_PATH . '/cache',
        ],
    ],

    'prefix' => 'framework_cache_',
    'ttl' => 3600,
];

// ============================================
// File: config\database.php
// ============================================

return [
    'default' => env('DB_CONNECTION', 'sqlite'),

    'connections' => [
        'sqlite' => [
            'driver' => 'sqlite',
            'database' => env('DB_DATABASE', base_path('database/app.db')),
        ],

        'mysql' => [
            'driver' => 'mysql',
            'host' => env('DB_HOST', 'localhost'),
            'port' => env('DB_PORT', 3306),
            'database' => env('DB_DATABASE', 'quill'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
        ],

        'mariadb' => [
            'driver' => 'mariadb',
            'host' => env('DB_HOST', 'localhost'),
            'port' => env('DB_PORT', 3306),
            'database' => env('DB_DATABASE', 'quill'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
        ],

        'pgsql' => [
            'driver' => 'pgsql',
            'host' => env('DB_HOST', 'localhost'),
            'port' => env('DB_PORT', 5432),
            'database' => env('DB_DATABASE', 'quill'),
            'username' => env('DB_USERNAME', 'postgres'),
            'password' => env('DB_PASSWORD', ''),
        ],
    ],
];

// ============================================
// File: config\logging.php
// ============================================

return [
    'default' => env('LOG_CHANNEL', 'stack'),

    'channels' => [
        'single' => [
            'driver' => 'single',
            'path' => STORAGE_PATH . '/logs/app.log',
        ],

        'daily' => [
            'driver' => 'daily',
            'path' => STORAGE_PATH . '/logs',
        ],

        'stack' => [
            'driver' => 'stack',
            'channels' => ['single', 'daily'],
        ],
    ],
];

// ============================================
// File: config\session.php
// ============================================

return [
    'driver' => env('SESSION_DRIVER', 'file'),
    
    'path' => STORAGE_PATH . '/sessions',
    
    'lifetime' => 120,
    
    'secure' => false,
    
    'http_only' => true,
    
    'same_site' => 'lax',
];

// ============================================
// File: src\Auth\AuthManager.php
// ============================================

namespace Framework\Auth;

use Framework\Database\Model;

/**
 * Authentication manager
 */
class AuthManager
{
    /**
     * Authenticated user
     *
     * @var Model|null
     */
    protected ?Model $user = null;

    /**
     * Guard name
     *
     * @var string
     */
    protected string $guard = 'web';

    /**
     * User model class
     *
     * @var string
     */
    protected string $userModel = 'App\\Models\\User';

    /**
     * Create a new auth manager
     */
    public function __construct()
    {
        $this->loadUserFromSession();
    }

    /**
     * Load user from session
     *
     * @return void
     */
    protected function loadUserFromSession(): void
    {
        $userId = session()->get('auth.user.id');

        if ($userId) {
            $modelClass = $this->userModel;
            $this->user = $modelClass::find($userId);
        }
    }

    /**
     * Check if user is authenticated
     *
     * @return bool
     */
    public function check(): bool
    {
        return $this->user !== null;
    }

    /**
     * Get the authenticated user
     *
     * @return Model|null
     */
    public function user(): ?Model
    {
        return $this->user;
    }

    /**
     * Get the authenticated user ID
     *
     * @return int|null
     */
    public function id(): ?int
    {
        return $this->user?->id;
    }

    /**
     * Authenticate a user
     *
     * @param string $email
     * @param string $password
     * @param bool $remember
     * @return bool
     */
    public function attempt(string $email, string $password, bool $remember = false): bool
    {
        $modelClass = $this->userModel;
        $user = $modelClass::findBy('email', $email);

        if (!$user) {
            return false;
        }

        if (!password_verify($password, $user->password)) {
            return false;
        }

        $this->login($user);
        return true;
    }

    /**
     * Log in a user
     *
     * @param Model $user
     * @return void
     */
    public function login(Model $user): void
    {
        $this->user = $user;
        session()->put('auth.user.id', $user->id);
    }

    /**
     * Log out the user
     *
     * @return void
     */
    public function logout(): void
    {
        $this->user = null;
        session()->forget('auth.user.id');
    }
}

// ============================================
// File: src\Auth\Guard.php
// ============================================

namespace Framework\Auth;

class Guard {
    protected $user;
    protected $sessionKey = 'auth_user';

    public function __construct() {
        if (!isset($_SESSION)) {
            session_start();
        }
    }

    public function attempt($email, $password) {
        $model = \App\Models\User::where('email', $email)->first();

        if (!$model) {
            return false;
        }

        if (!\Framework\Security\Hash::check($password, $model->getAttribute('password'))) {
            return false;
        }

        $this->login($model);

        return true;
    }

    public function login($user) {
        $_SESSION[$this->sessionKey] = serialize($user);
        $this->user = $user;
    }

    public function logout() {
        unset($_SESSION[$this->sessionKey]);
        $this->user = null;
    }

    public function user() {
        if ($this->user === null && isset($_SESSION[$this->sessionKey])) {
            $this->user = unserialize($_SESSION[$this->sessionKey]);
        }

        return $this->user;
    }

    public function check() {
        return $this->user() !== null;
    }

    public function guest() {
        return !$this->check();
    }

    public function id() {
        $user = $this->user();
        return $user ? $user->getAttribute('id') : null;
    }
}

// ============================================
// File: src\Cache\Store.php
// ============================================

namespace Framework\Cache;

class Store {
    protected $path;
    protected $defaultTtl = 3600;

    public function __construct($path = null) {
        $this->path = $path ?? STORAGE_PATH . '/cache';

        if (!is_dir($this->path)) {
            mkdir($this->path, 0755, true);
        }
    }

    public function put($key, $value, $minutes = null) {
        $ttl = $minutes ? $minutes * 60 : $this->defaultTtl;
        $expiration = time() + $ttl;

        $data = [
            'value' => $value,
            'expiration' => $expiration,
        ];

        $file = $this->getPath($key);
        file_put_contents($file, serialize($data));

        return $this;
    }

    public function get($key, $default = null) {
        $file = $this->getPath($key);

        if (!file_exists($file)) {
            return $default;
        }

        $data = unserialize(file_get_contents($file));

        if ($data['expiration'] < time()) {
            unlink($file);
            return $default;
        }

        return $data['value'];
    }

    public function has($key) {
        return $this->get($key) !== null;
    }

    public function forget($key) {
        $file = $this->getPath($key);

        if (file_exists($file)) {
            unlink($file);
        }

        return $this;
    }

    public function flush() {
        $files = glob($this->path . '/*');

        foreach ($files as $file) {
            if (is_file($file)) {
                unlink($file);
            }
        }

        return $this;
    }

    public function remember($key, $minutes, $callback) {
        if ($this->has($key)) {
            return $this->get($key);
        }

        $value = call_user_func($callback);

        $this->put($key, $value, $minutes);

        return $value;
    }

    protected function getPath($key) {
        $hash = md5($key);
        return $this->path . '/' . $hash . '.cache';
    }
}

// ============================================
// File: src\Config\Config.php
// ============================================

namespace Framework\Config;

/**
 * Configuration manager
 * 
 * Handles application configuration with dot notation access
 */
class Config
{
    /**
     * Configuration items
     *
     * @var array
     */
    protected array $items = [];

    /**
     * Create a new Config instance
     *
     * @param array $items
     */
    public function __construct(array $items = [])
    {
        $this->items = $items;
    }

    /**
     * Get a configuration value
     *
     * @param string $key
     * @param mixed $default
     * @return mixed
     */
    public function get(string $key, $default = null)
    {
        $keys = explode('.', $key);
        $value = $this->items;

        foreach ($keys as $segment) {
            if (is_array($value) && array_key_exists($segment, $value)) {
                $value = $value[$segment];
            } else {
                return $default;
            }
        }

        return $value;
    }

    /**
     * Set a configuration value
     *
     * @param string $key
     * @param mixed $value
     * @return void
     */
    public function set(string $key, $value): void
    {
        $keys = explode('.', $key);
        $current = &$this->items;

        foreach ($keys as $i => $segment) {
            if ($i === count($keys) - 1) {
                $current[$segment] = $value;
            } else {
                if (!isset($current[$segment])) {
                    $current[$segment] = [];
                }
                $current = &$current[$segment];
            }
        }
    }

    /**
     * Check if a configuration key exists
     *
     * @param string $key
     * @return bool
     */
    public function has(string $key): bool
    {
        $keys = explode('.', $key);
        $value = $this->items;

        foreach ($keys as $segment) {
            if (is_array($value) && array_key_exists($segment, $value)) {
                $value = $value[$segment];
            } else {
                return false;
            }
        }

        return true;
    }

    /**
     * Get all configuration
     *
     * @return array
     */
    public function all(): array
    {
        return $this->items;
    }

    /**
     * Get a configuration group
     *
     * @param string $group
     * @return array
     */
    public function group(string $group): array
    {
        return $this->get($group, []);
    }

    /**
     * Load configuration from a file
     *
     * @param string $path
     * @return array
     */
    public static function load(string $path): array
    {
        if (!file_exists($path)) {
            return [];
        }

        return require $path;
    }
}

// ============================================
// File: src\Config\Repository.php
// ============================================

namespace Framework\Config;

class Repository {
    protected $items = [];

    public function get($key, $default = null) {
        if (strpos($key, '.') === false) {
            return $this->items[$key] ?? $default;
        }

        $parts = explode('.', $key);
        $value = $this->items;

        foreach ($parts as $part) {
            if (is_array($value) && isset($value[$part])) {
                $value = $value[$part];
            } else {
                return $default;
            }
        }

        return $value;
    }

    public function set($key, $value) {
        if (strpos($key, '.') === false) {
            $this->items[$key] = $value;
            return;
        }

        $parts = explode('.', $key);
        $key = array_pop($parts);
        $array = &$this->items;

        foreach ($parts as $part) {
            if (!isset($array[$part])) {
                $array[$part] = [];
            }
            $array = &$array[$part];
        }

        $array[$key] = $value;
    }

    public function has($key) {
        return $this->get($key) !== null;
    }

    public function all() {
        return $this->items;
    }
}

// ============================================
// File: src\Console\Application.php
// ============================================

namespace Framework\Console;

/**
 * Console application for CLI commands
 */
class Application
{
    /**
     * Application container
     *
     * @var \Framework\Container\Container
     */
    protected \Framework\Container\Container $container;

    /**
     * Registered commands
     *
     * @var array
     */
    protected array $commands = [];

    /**
     * Create a new console application
     */
    public function __construct()
    {
        $this->container = app();
        $this->registerCommands();
    }

    /**
     * Register all commands
     *
     * @return void
     */
    protected function registerCommands(): void
    {
        $this->commands = [
            'serve' => \Framework\Console\Commands\ServeCommand::class,
            'migrate' => \Framework\Console\Commands\MigrateCommand::class,
            'migrate:rollback' => \Framework\Console\Commands\MigrateRollbackCommand::class,
            'seed' => \Framework\Console\Commands\SeedCommand::class,
            'tinker' => \Framework\Console\Commands\TinkerCommand::class,
            'make:controller' => \Framework\Console\Commands\MakeControllerCommand::class,
            'make:model' => \Framework\Console\Commands\MakeModelCommand::class,
            'make:migration' => \Framework\Console\Commands\MakeMigrationCommand::class,
            'make:request' => \Framework\Console\Commands\MakeRequestCommand::class,
            'make:provider' => \Framework\Console\Commands\MakeProviderCommand::class,
        ];
    }

    /**
     * Handle console input
     *
     * @param int $argc
     * @param array $argv
     * @return int
     */
    public function handle(int $argc, array $argv): int
    {
        if ($argc < 2) {
            $this->showHelp();
            return 0;
        }

        $command = $argv[1];
        $arguments = array_slice($argv, 2);

        if (!isset($this->commands[$command])) {
            echo "Command not found: {$command}\n";
            return 1;
        }

        try {
            $commandClass = $this->commands[$command];
            $commandInstance = new $commandClass();
            return $commandInstance->handle($arguments);
        } catch (\Exception $e) {
            echo "Error: " . $e->getMessage() . "\n";
            return 1;
        }
    }

    /**
     * Show help
     *
     * @return void
     */
    protected function showHelp(): void
    {
        echo "\nQuill Framework Console\n";
        echo "=======================\n\n";
        echo "Available commands:\n";
        foreach ($this->commands as $name => $class) {
            echo "  php artisan {$name}\n";
        }
        echo "\n";
    }
}

// ============================================
// File: src\Console\Command.php
// ============================================

namespace Framework\Console;

/**
 * Base console command class
 */
abstract class Command
{
    /**
     * Command name
     *
     * @var string
     */
    protected string $name = '';

    /**
     * Command description
     *
     * @var string
     */
    protected string $description = '';

    /**
     * Arguments
     *
     * @var array
     */
    protected array $arguments = [];

    /**
     * Handle the command
     *
     * @param array $arguments
     * @return int
     */
    abstract public function handle(array $arguments): int;

    /**
     * Write output
     *
     * @param string $message
     * @return void
     */
    protected function info(string $message): void
    {
        echo $message . "\n";
    }

    /**
     * Write error
     *
     * @param string $message
     * @return void
     */
    protected function error(string $message): void
    {
        echo "Error: {$message}\n";
    }

    /**
     * Get an argument
     *
     * @param int $index
     * @param string|null $default
     * @return string|null
     */
    protected function argument(int $index, ?string $default = null): ?string
    {
        return $this->arguments[$index] ?? $default;
    }
}

// ============================================
// File: src\Console\Commands\Command.php
// ============================================

namespace Framework\Console\Commands;

abstract class Command {
    protected $signature;
    protected $description;

    abstract public function handle($args);

    protected function info($message) {
        echo "[INFO] $message\n";
    }

    protected function error($message) {
        echo "[ERROR] $message\n";
    }

    protected function warn($message) {
        echo "[WARN] $message\n";
    }

    protected function line($message = '') {
        echo $message . "\n";
    }
}

// ============================================
// File: src\Console\Commands\MakeControllerCommand.php
// ============================================

namespace Framework\Console\Commands;

use Framework\Console\Command;

/**
 * Make controller command
 */
class MakeControllerCommand extends Command
{
    /**
     * Handle the command
     *
     * @param array $arguments
     * @return int
     */
    public function handle(array $arguments): int
    {
        if (empty($arguments[0])) {
            $this->error('Controller name required');
            return 1;
        }

        $name = $arguments[0];
        $controllersPath = app_path('Controllers');

        if (!is_dir($controllersPath)) {
            mkdir($controllersPath, 0755, true);
        }

        $file = $controllersPath . '/' . $name . '.php';

        if (file_exists($file)) {
            $this->error("Controller already exists: {$name}");
            return 1;
        }

        $stub = $this->getStub($name);
        file_put_contents($file, $stub);

        $this->info("Created controller: {$name}");
        return 0;
    }

    /**
     * Get stub
     *
     * @param string $name
     * @return string
     */
    protected function getStub(string $name): string
    {
        return <<<PHP
<?php

namespace App\Controllers;

use Framework\Foundation\Controller;
use Framework\Http\Request;

class {$name} extends Controller
{
    /**
     * Constructor
     */
    public function __construct()
    {
        parent::__construct();
    }

    /**
     * Display a listing
     */
    public function index()
    {
        return response('Index action');
    }

    /**
     * Show create form
     */
    public function create()
    {
        return response('Create action');
    }

    /**
     * Store a new record
     */
    public function store(Request \$request)
    {
        return response('Store action');
    }

    /**
     * Show a record
     */
    public function show(\$id)
    {
        return response('Show action for ID: ' . \$id);
    }

    /**
     * Show edit form
     */
    public function edit(\$id)
    {
        return response('Edit action');
    }

    /**
     * Update a record
     */
    public function update(Request \$request, \$id)
    {
        return response('Update action');
    }

    /**
     * Delete a record
     */
    public function destroy(\$id)
    {
        return response('Delete action');
    }
}
PHP;
    }
}

// ============================================
// File: src\Console\Commands\MakeMigrationCommand.php
// ============================================

namespace Framework\Console\Commands;

use Framework\Console\Command;

/**
 * Make migration command
 */
class MakeMigrationCommand extends Command
{
    /**
     * Handle the command
     *
     * @param array $arguments
     * @return int
     */
    public function handle(array $arguments): int
    {
        if (empty($arguments[0])) {
            $this->error('Migration name required');
            return 1;
        }

        $name = $arguments[0];
        $migrationsPath = database_path('migrations');

        if (!is_dir($migrationsPath)) {
            mkdir($migrationsPath, 0755, true);
        }

        $timestamp = date('Y_m_d_His');
        $className = $this->getClassName($name);
        $file = $migrationsPath . '/' . $timestamp . '_' . $name . '.php';

        $stub = $this->getStub($className);
        file_put_contents($file, $stub);

        $this->info("Created migration: {$name}");
        return 0;
    }

    /**
     * Get class name
     *
     * @param string $name
     * @return string
     */
    protected function getClassName(string $name): string
    {
        return str_replace('_', '', ucwords($name, '_'));
    }

    /**
     * Get stub
     *
     * @param string $className
     * @return string
     */
    protected function getStub(string $className): string
    {
        return <<<PHP
<?php

class {$className}
{
    /**
     * Run the migration
     */
    public function up(): void
    {
        // Create table or modify schema
    }

    /**
     * Rollback the migration
     */
    public function down(): void
    {
        // Reverse the migration
    }
}
PHP;
    }
}

// ============================================
// File: src\Console\Commands\MakeModelCommand.php
// ============================================

namespace Framework\Console\Commands;

use Framework\Console\Command;

/**
 * Make model command
 */
class MakeModelCommand extends Command
{
    /**
     * Handle the command
     *
     * @param array $arguments
     * @return int
     */
    public function handle(array $arguments): int
    {
        if (empty($arguments[0])) {
            $this->error('Model name required');
            return 1;
        }

        $name = $arguments[0];
        $modelsPath = app_path('Models');

        if (!is_dir($modelsPath)) {
            mkdir($modelsPath, 0755, true);
        }

        $file = $modelsPath . '/' . $name . '.php';

        if (file_exists($file)) {
            $this->error("Model already exists: {$name}");
            return 1;
        }

        $stub = $this->getStub($name);
        file_put_contents($file, $stub);

        $this->info("Created model: {$name}");
        return 0;
    }

    /**
     * Get stub
     *
     * @param string $name
     * @return string
     */
    protected function getStub(string $name): string
    {
        return <<<PHP
<?php

namespace App\Models;

use Framework\Database\Model;

class {$name} extends Model
{
    /**
     * Table name
     *
     * @var string
     */
    protected ?string \$table = null;

    /**
     * Primary key
     *
     * @var string
     */
    protected string \$primaryKey = 'id';

    /**
     * Fillable attributes
     *
     * @var array
     */
    protected array \$fillable = [];

    /**
     * Soft delete column
     *
     * @var string|null
     */
    protected ?string \$softDeleteColumn = 'deleted_at';
}
PHP;
    }
}

// ============================================
// File: src\Console\Commands\MakeProviderCommand.php
// ============================================

namespace Framework\Console\Commands;

use Framework\Console\Command;

/**
 * Make provider command
 */
class MakeProviderCommand extends Command
{
    /**
     * Handle the command
     *
     * @param array $arguments
     * @return int
     */
    public function handle(array $arguments): int
    {
        if (empty($arguments[0])) {
            $this->error('Provider name required');
            return 1;
        }

        $name = $arguments[0];
        $providersPath = app_path('Providers');

        if (!is_dir($providersPath)) {
            mkdir($providersPath, 0755, true);
        }

        $file = $providersPath . '/' . $name . '.php';

        if (file_exists($file)) {
            $this->error("Provider already exists: {$name}");
            return 1;
        }

        $stub = $this->getStub($name);
        file_put_contents($file, $stub);

        $this->info("Created provider: {$name}");
        return 0;
    }

    /**
     * Get stub
     *
     * @param string $name
     * @return string
     */
    protected function getStub(string $name): string
    {
        return <<<PHP
<?php

namespace App\Providers;

use Framework\Container\Container;

class {$name}
{
    /**
     * Container instance
     *
     * @var Container
     */
    protected Container \$container;

    /**
     * Constructor
     *
     * @param Container \$container
     */
    public function __construct(Container \$container)
    {
        \$this->container = \$container;
    }

    /**
     * Register services
     *
     * @return void
     */
    public function register(): void
    {
        // Register services into the container
    }

    /**
     * Boot services
     *
     * @return void
     */
    public function boot(): void
    {
        // Boot services after registration
    }
}
PHP;
    }
}

// ============================================
// File: src\Console\Commands\MakeRequestCommand.php
// ============================================

namespace Framework\Console\Commands;

use Framework\Console\Command;

/**
 * Make request command
 */
class MakeRequestCommand extends Command
{
    /**
     * Handle the command
     *
     * @param array $arguments
     * @return int
     */
    public function handle(array $arguments): int
    {
        if (empty($arguments[0])) {
            $this->error('Request name required');
            return 1;
        }

        $name = $arguments[0];
        $requestsPath = app_path('Requests');

        if (!is_dir($requestsPath)) {
            mkdir($requestsPath, 0755, true);
        }

        $file = $requestsPath . '/' . $name . '.php';

        if (file_exists($file)) {
            $this->error("Request already exists: {$name}");
            return 1;
        }

        $stub = $this->getStub($name);
        file_put_contents($file, $stub);

        $this->info("Created request: {$name}");
        return 0;
    }

    /**
     * Get stub
     *
     * @param string $name
     * @return string
     */
    protected function getStub(string $name): string
    {
        return <<<PHP
<?php

namespace App\Requests;

use Framework\Http\Request;

class {$name}
{
    /**
     * Get validation rules
     *
     * @return array
     */
    public function rules(): array
    {
        return [
            // 'field' => 'required|string|max:255'
        ];
    }

    /**
     * Get custom error messages
     *
     * @return array
     */
    public function messages(): array
    {
        return [
            // 'field.required' => 'The field is required'
        ];
    }
}
PHP;
    }
}

// ============================================
// File: src\Console\Commands\MigrateCommand.php
// ============================================

namespace Framework\Console\Commands;

use Framework\Console\Command;

/**
 * Migrate command - run database migrations
 */
class MigrateCommand extends Command
{
    /**
     * Handle the command
     *
     * @param array $arguments
     * @return int
     */
    public function handle(array $arguments): int
    {
        $this->info('Running migrations...');

        $migrationsPath = database_path('migrations');

        if (!is_dir($migrationsPath)) {
            $this->error('Migrations directory not found');
            return 1;
        }

        $files = glob($migrationsPath . '/*.php');

        if (empty($files)) {
            $this->info('No migrations to run');
            return 0;
        }

        foreach ($files as $file) {
            require $file;
            $className = $this->getClassNameFromFile($file);

            if (class_exists($className)) {
                $migration = new $className();
                if (method_exists($migration, 'up')) {
                    $migration->up();
                    $this->info("Migrated: " . basename($file));
                }
            }
        }

        $this->info('Migrations completed');
        return 0;
    }

    /**
     * Get class name from file
     *
     * @param string $file
     * @return string
     */
    protected function getClassNameFromFile(string $file): string
    {
        $content = file_get_contents($file);

        if (preg_match('/class\s+(\w+)/', $content, $matches)) {
            return $matches[1];
        }

        return '';
    }
}

// ============================================
// File: src\Console\Commands\MigrateRollbackCommand.php
// ============================================

namespace Framework\Console\Commands;

use Framework\Console\Command;

/**
 * Migrate rollback command
 */
class MigrateRollbackCommand extends Command
{
    /**
     * Handle the command
     *
     * @param array $arguments
     * @return int
     */
    public function handle(array $arguments): int
    {
        $this->info('Rolling back migrations...');

        $migrationsPath = database_path('migrations');

        if (!is_dir($migrationsPath)) {
            $this->error('Migrations directory not found');
            return 1;
        }

        $files = array_reverse(glob($migrationsPath . '/*.php'));

        if (empty($files)) {
            $this->info('No migrations to rollback');
            return 0;
        }

        foreach ($files as $file) {
            require $file;
            $className = $this->getClassNameFromFile($file);

            if (class_exists($className)) {
                $migration = new $className();
                if (method_exists($migration, 'down')) {
                    $migration->down();
                    $this->info("Rolled back: " . basename($file));
                }
            }
        }

        $this->info('Rollback completed');
        return 0;
    }

    /**
     * Get class name from file
     *
     * @param string $file
     * @return string
     */
    protected function getClassNameFromFile(string $file): string
    {
        $content = file_get_contents($file);

        if (preg_match('/class\s+(\w+)/', $content, $matches)) {
            return $matches[1];
        }

        return '';
    }
}

// ============================================
// File: src\Console\Commands\RollbackCommand.php
// ============================================

namespace Framework\Console\Commands;

use Framework\Database\Migrations\MigrationRunner;

class RollbackCommand extends Command {
    protected $signature = 'migrate:rollback';
    protected $description = 'Rollback the last batch of database migrations';

    public function handle($args) {
        $runner = new MigrationRunner(app('db'), DATABASE_PATH . '/migrations');

        try {
            $runner->rollback();
            $this->info('Rollback completed successfully');
            return 0;
        } catch (\Exception $e) {
            $this->error('Rollback failed: ' . $e->getMessage());
            return 1;
        }
    }
}

// ============================================
// File: src\Console\Commands\SeedCommand.php
// ============================================

namespace Framework\Console\Commands;

use Framework\Console\Command;

/**
 * Seed command - seed database with data
 */
class SeedCommand extends Command
{
    /**
     * Handle the command
     *
     * @param array $arguments
     * @return int
     */
    public function handle(array $arguments): int
    {
        $this->info('Seeding database...');

        $seedersPath = database_path('seeders');

        if (!is_dir($seedersPath)) {
            $this->error('Seeders directory not found');
            return 1;
        }

        $files = glob($seedersPath . '/*.php');

        if (empty($files)) {
            $this->info('No seeders found');
            return 0;
        }

        foreach ($files as $file) {
            require $file;
            $className = $this->getClassNameFromFile($file);

            if (class_exists($className)) {
                $seeder = new $className();
                if (method_exists($seeder, 'run')) {
                    $seeder->run();
                    $this->info("Seeded: " . basename($file));
                }
            }
        }

        $this->info('Seeding completed');
        return 0;
    }

    /**
     * Get class name from file
     *
     * @param string $file
     * @return string
     */
    protected function getClassNameFromFile(string $file): string
    {
        $content = file_get_contents($file);

        if (preg_match('/class\s+(\w+)/', $content, $matches)) {
            return $matches[1];
        }

        return '';
    }
}

// ============================================
// File: src\Console\Commands\ServeCommand.php
// ============================================

namespace Framework\Console\Commands;

use Framework\Console\Command;

/**
 * Serve command - run PHP development server
 */
class ServeCommand extends Command
{
    /**
     * Handle the command
     *
     * @param array $arguments
     * @return int
     */
    public function handle(array $arguments): int
    {
        $host = $arguments[0] ?? 'localhost';
        $port = $arguments[1] ?? 8000;

        $this->info("Starting development server at http://{$host}:{$port}");

        $publicPath = base_path('public');
        passthru("php -S {$host}:{$port} -t {$publicPath}");

        return 0;
    }
}

// ============================================
// File: src\Console\Commands\TinkerCommand.php
// ============================================

namespace Framework\Console\Commands;

use Framework\Console\Command;

/**
 * Tinker command - interactive shell
 */
class TinkerCommand extends Command
{
    /**
     * Handle the command
     *
     * @param array $arguments
     * @return int
     */
    public function handle(array $arguments): int
    {
        $this->info('Quill Tinker - Interactive Shell');
        $this->info('Type "exit" to quit');
        $this->info('');

        while (true) {
            echo 'tinker> ';
            $input = trim(fgets(STDIN));

            if ($input === 'exit') {
                break;
            }

            if (empty($input)) {
                continue;
            }

            try {
                // Wrap in a function for proper variable scope
                $result = $this->evaluate($input);
                if ($result !== null) {
                    var_dump($result);
                }
            } catch (\Exception $e) {
                echo "Error: " . $e->getMessage() . "\n";
            }
        }

        return 0;
    }

    /**
     * Evaluate code
     *
     * @param string $code
     * @return mixed
     */
    protected function evaluate(string $code)
    {
        return eval('return ' . $code . ';');
    }
}

// ============================================
// File: src\Container\Container.php
// ============================================

namespace Framework\Container;

use Closure;
use ReflectionClass;
use ReflectionParameter;

/**
 * Service Container for dependency injection
 * 
 * Manages service bindings, singletons, and automatic resolution
 */
class Container
{
    /**
     * The registered bindings in the container
     *
     * @var array
     */
    protected array $bindings = [];

    /**
     * The registered singletons in the container
     *
     * @var array
     */
    protected array $instances = [];

    /**
     * The resolved instances cache
     *
     * @var array
     */
    protected array $resolved = [];

    /**
     * Bind a service to the container
     *
     * @param string $abstract
     * @param Closure|string|null $concrete
     * @return void
     */
    public function bind(string $abstract, $concrete = null): void
    {
        if ($concrete === null) {
            $concrete = $abstract;
        }

        if (!$concrete instanceof Closure) {
            $concrete = $this->getClosure($abstract, $concrete);
        }

        $this->bindings[$abstract] = [
            'concrete' => $concrete,
            'singleton' => false,
        ];
    }

    /**
     * Bind a singleton to the container
     *
     * @param string $abstract
     * @param Closure|string|null $concrete
     * @return void
     */
    public function singleton(string $abstract, $concrete = null): void
    {
        $this->bind($abstract, $concrete);
        $this->bindings[$abstract]['singleton'] = true;
    }

    /**
     * Register an instance as singleton
     *
     * @param string $abstract
     * @param mixed $instance
     * @return void
     */
    public function instance(string $abstract, $instance): void
    {
        $this->instances[$abstract] = $instance;
    }

    /**
     * Resolve a service from the container
     *
     * @param string $abstract
     * @return mixed
     */
    public function make(string $abstract)
    {
        // Check if already instantiated as singleton
        if (isset($this->instances[$abstract])) {
            return $this->instances[$abstract];
        }

        // Check if binding exists
        if (!isset($this->bindings[$abstract])) {
            // Try to auto-resolve class
            return $this->resolve($abstract);
        }

        $binding = $this->bindings[$abstract];
        $concrete = $binding['concrete'];

        // Call the binding's concrete
        $instance = $concrete($this);

        // If singleton, cache the instance
        if ($binding['singleton']) {
            $this->instances[$abstract] = $instance;
        }

        return $instance;
    }

    /**
     * Get a closure for a binding
     *
     * @param string $abstract
     * @param string|Closure $concrete
     * @return Closure
     */
    protected function getClosure(string $abstract, $concrete): Closure
    {
        return function ($container) use ($abstract, $concrete) {
            if ($concrete === $abstract) {
                return $container->resolve($abstract);
            }
            return $container->make($concrete);
        };
    }

    /**
     * Resolve a class instance
     *
     * @param string $class
     * @return mixed
     */
    public function resolve(string $class)
    {
        try {
            $reflection = new ReflectionClass($class);

            if (!$reflection->isInstantiable()) {
                throw new \RuntimeException("Class {$class} cannot be instantiated");
            }

            $constructor = $reflection->getConstructor();

            if ($constructor === null) {
                return new $class();
            }

            $parameters = $constructor->getParameters();
            $dependencies = [];

            foreach ($parameters as $parameter) {
                $dependency = $parameter->getType();

                if ($dependency === null) {
                    if ($parameter->isDefaultValueAvailable()) {
                        $dependencies[] = $parameter->getDefaultValue();
                    } else {
                        throw new \RuntimeException("Cannot resolve parameter {$parameter->getName()} in {$class}");
                    }
                } else {
                    $dependencyName = $dependency->getName();
                    $dependencies[] = $this->make($dependencyName);
                }
            }

            return new $class(...$dependencies);
        } catch (\ReflectionException $e) {
            throw new \RuntimeException("Cannot resolve class {$class}: " . $e->getMessage());
        }
    }

    /**
     * Check if a binding exists
     *
     * @param string $abstract
     * @return bool
     */
    public function has(string $abstract): bool
    {
        return isset($this->bindings[$abstract]) || isset($this->instances[$abstract]);
    }

    /**
     * Get all bindings
     *
     * @return array
     */
    public function getBindings(): array
    {
        return $this->bindings;
    }

    /**
     * Call a function with dependency injection
     *
     * @param callable $callback
     * @param array $parameters
     * @return mixed
     */
    public function call(callable $callback, array $parameters = [])
    {
        if (is_array($callback)) {
            [$instance, $method] = $callback;
            return $this->callMethod($instance, $method, $parameters);
        }

        return $callback($this, ...$parameters);
    }

    /**
     * Call a method with dependency injection
     *
     * @param object $instance
     * @param string $method
     * @param array $parameters
     * @return mixed
     */
    public function callMethod($instance, string $method, array $parameters = [])
    {
        $reflection = new ReflectionClass($instance);
        $reflectionMethod = $reflection->getMethod($method);

        $methodParameters = $reflectionMethod->getParameters();
        $dependencies = [];

        foreach ($methodParameters as $parameter) {
            if (isset($parameters[$parameter->getName()])) {
                $dependencies[] = $parameters[$parameter->getName()];
            } else {
                $dependency = $parameter->getType();
                if ($dependency !== null) {
                    $dependencyName = $dependency->getName();
                    $dependencies[] = $this->make($dependencyName);
                } elseif ($parameter->isDefaultValueAvailable()) {
                    $dependencies[] = $parameter->getDefaultValue();
                }
            }
        }

        return $reflectionMethod->invokeArgs($instance, $dependencies);
    }
}

// ============================================
// File: src\Database\Connection.php
// ============================================

namespace Framework\Database;

use PDO;
use PDOStatement;

/**
 * Database connection wrapper
 */
class Connection
{
    /**
     * PDO instance
     *
     * @var PDO
     */
    protected PDO $pdo;

    /**
     * Connection configuration
     *
     * @var array
     */
    protected array $config;

    /**
     * Create a new connection
     *
     * @param array $config
     */
    public function __construct(array $config)
    {
        $this->config = $config;
        $this->connect();
    }

    /**
     * Establish the database connection
     *
     * @return void
     */
    protected function connect(): void
    {
        $driver = $this->config['driver'] ?? 'sqlite';

        switch ($driver) {
            case 'sqlite':
                $dsn = 'sqlite:' . $this->config['database'];
                break;
            case 'mysql':
            case 'mariadb':
                $host = $this->config['host'] ?? 'localhost';
                $port = $this->config['port'] ?? 3306;
                $database = $this->config['database'];
                $dsn = "mysql:host={$host};port={$port};dbname={$database}";
                break;
            case 'pgsql':
                $host = $this->config['host'] ?? 'localhost';
                $port = $this->config['port'] ?? 5432;
                $database = $this->config['database'];
                $dsn = "pgsql:host={$host};port={$port};dbname={$database}";
                break;
            default:
                throw new \RuntimeException("Unsupported database driver: {$driver}");
        }

        $options = [
            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        ];

        try {
            $this->pdo = new PDO(
                $dsn,
                $this->config['username'] ?? null,
                $this->config['password'] ?? null,
                $options
            );
        } catch (\PDOException $e) {
            throw new \RuntimeException('Database connection failed: ' . $e->getMessage());
        }
    }

    /**
     * Execute a query
     *
     * @param string $query
     * @param array $bindings
     * @return PDOStatement
     */
    public function execute(string $query, array $bindings = []): PDOStatement
    {
        $statement = $this->pdo->prepare($query);
        $statement->execute($bindings);
        return $statement;
    }

    /**
     * Select data
     *
     * @param string $query
     * @param array $bindings
     * @return array
     */
    public function select(string $query, array $bindings = []): array
    {
        return $this->execute($query, $bindings)->fetchAll();
    }

    /**
     * Insert data
     *
     * @param string $table
     * @param array $values
     * @return bool
     */
    public function insert(string $table, array $values): bool
    {
        $columns = implode(',', array_keys($values));
        $placeholders = implode(',', array_fill(0, count($values), '?'));
        $query = "INSERT INTO {$table} ({$columns}) VALUES ({$placeholders})";

        return $this->execute($query, array_values($values))->rowCount() > 0;
    }

    /**
     * Update data
     *
     * @param string $table
     * @param array $values
     * @param string $where
     * @param array $bindings
     * @return int
     */
    public function update(string $table, array $values, string $where, array $bindings = []): int
    {
        $sets = [];
        foreach (array_keys($values) as $column) {
            $sets[] = "{$column} = ?";
        }
        $setClause = implode(',', $sets);
        $query = "UPDATE {$table} SET {$setClause} WHERE {$where}";

        $allBindings = array_merge(array_values($values), $bindings);
        return $this->execute($query, $allBindings)->rowCount();
    }

    /**
     * Delete data
     *
     * @param string $table
     * @param string $where
     * @param array $bindings
     * @return int
     */
    public function delete(string $table, string $where, array $bindings = []): int
    {
        $query = "DELETE FROM {$table} WHERE {$where}";
        return $this->execute($query, $bindings)->rowCount();
    }

    /**
     * Get the last inserted ID
     *
     * @return int
     */
    public function lastInsertId(): int
    {
        return (int)$this->pdo->lastInsertId();
    }

    /**
     * Get the PDO instance
     *
     * @return PDO
     */
    public function getPdo(): PDO
    {
        return $this->pdo;
    }

    /**
     * Begin a transaction
     *
     * @return bool
     */
    public function beginTransaction(): bool
    {
        return $this->pdo->beginTransaction();
    }

    /**
     * Commit a transaction
     *
     * @return bool
     */
    public function commit(): bool
    {
        return $this->pdo->commit();
    }

    /**
     * Rollback a transaction
     *
     * @return bool
     */
    public function rollback(): bool
    {
        return $this->pdo->rollBack();
    }
}

// ============================================
// File: src\Database\Factory.php
// ============================================

namespace Framework\Database;

class Factory {
    protected $model;
    protected $attributes = [];
    protected $count = 1;

    public function __construct($model) {
        $this->model = $model;
    }

    public function definition() {
        return [];
    }

    public function state($state) {
        // Override attributes for specific state
        return $this;
    }

    public function attributes($attributes = []) {
        $this->attributes = array_merge($this->definition(), $attributes);
        return $this;
    }

    public function count($count) {
        $this->count = $count;
        return $this;
    }

    public function create($attributes = []) {
        $attributes = array_merge($this->definition(), $attributes);

        $models = [];

        for ($i = 0; $i < $this->count; $i++) {
            $models[] = $this->model::create($attributes);
        }

        return $this->count === 1 ? $models[0] : $models;
    }

    public function make($attributes = []) {
        $attributes = array_merge($this->definition(), $attributes);

        $models = [];

        for ($i = 0; $i < $this->count; $i++) {
            $models[] = new $this->model($attributes);
        }

        return $this->count === 1 ? $models[0] : $models;
    }
}

// ============================================
// File: src\Database\Manager.php
// ============================================

namespace Framework\Database;

use Framework\Config\Config;

/**
 * Database manager for connection pooling
 */
class Manager
{
    /**
     * Configuration
     *
     * @var Config
     */
    protected Config $config;

    /**
     * Connections
     *
     * @var array
     */
    protected array $connections = [];

    /**
     * Current connection name
     *
     * @var string
     */
    protected string $currentConnection;

    /**
     * Create a new manager
     *
     * @param Config $config
     */
    public function __construct(Config $config)
    {
        $this->config = $config;
        $this->currentConnection = $config->get('database.default', 'sqlite');
    }

    /**
     * Get a connection
     *
     * @param string|null $name
     * @return Connection
     */
    public function connection(?string $name = null): Connection
    {
        $name = $name ?? $this->currentConnection;

        if (!isset($this->connections[$name])) {
            $config = $this->config->get("database.connections.{$name}");
            
            if (!$config) {
                throw new \RuntimeException("Database connection [{$name}] not found");
            }

            $this->connections[$name] = new Connection($config);
        }

        return $this->connections[$name];
    }

    /**
     * Get a query builder for a table
     *
     * @param string $table
     * @return QueryBuilder
     */
    public function table(string $table): QueryBuilder
    {
        return new QueryBuilder($this->connection(), $table);
    }

    /**
     * Set the current connection
     *
     * @param string $name
     * @return self
     */
    public function use(string $name): self
    {
        $this->currentConnection = $name;
        return $this;
    }

    /**
     * Get the current connection
     *
     * @return Connection
     */
    public function getCurrentConnection(): Connection
    {
        return $this->connection();
    }
}

// ============================================
// File: src\Database\Migrations\Migration.php
// ============================================

namespace Framework\Database\Migrations;

use Framework\Database\Schema\Builder;

class Migration {
    protected $schemaBuilder;

    public function __construct() {
        $this->schemaBuilder = new Builder(app('db')->connection());
    }

    protected function schema() {
        return $this->schemaBuilder;
    }

    public function up() {
    }

    public function down() {
    }
}

// ============================================
// File: src\Database\Migrations\MigrationRunner.php
// ============================================

namespace Framework\Database\Migrations;

use Framework\Database\Manager;
use Framework\Database\Schema\Builder;

class MigrationRunner {
    protected $manager;
    protected $migrationsPath;
    protected $batch = 1;

    public function __construct(Manager $manager, $migrationsPath = null) {
        $this->manager = $manager;
        $this->migrationsPath = $migrationsPath ?? DATABASE_PATH . '/migrations';
    }

    public function run() {
        $this->ensureMigrationsTable();

        $files = $this->getPendingMigrations();

        foreach ($files as $file) {
            $this->runMigration($file);
        }
    }

    public function rollback() {
        $this->ensureMigrationsTable();

        $batch = $this->getLastBatch();

        if ($batch === null) {
            return;
        }

        $migrations = $this->getMigrationsForBatch($batch);

        foreach (array_reverse($migrations) as $migration) {
            $this->rollbackMigration($migration);
        }
    }

    protected function runMigration($file) {
        $className = $this->getMigrationClassName($file);
        $class = "Database\\Migrations\\$className";

        if (!class_exists($class)) {
            include $this->migrationsPath . '/' . $file;
        }

        $migration = new $class();
        $migration->up();

        $this->recordMigration($file);
    }

    protected function rollbackMigration($migration) {
        $file = $migration['migration'];
        $className = $this->getMigrationClassName($file);
        $class = "Database\\Migrations\\$className";

        if (!class_exists($class)) {
            include $this->migrationsPath . '/' . $file . '.php';
        }

        $instance = new $class();
        $instance->down();

        $this->forgetMigration($file);
    }

    protected function ensureMigrationsTable() {
        $connection = $this->manager->connection();

        try {
            $connection->selectOne('SELECT 1 FROM migrations LIMIT 1');
        } catch (\Exception $e) {
            $schema = new Builder($connection);
            $schema->create('migrations', function ($table) {
                $table->increments('id');
                $table->string('migration');
                $table->integer('batch');
                $table->timestamps();
            });
        }
    }

    protected function getPendingMigrations() {
        if (!is_dir($this->migrationsPath)) {
            return [];
        }

        $files = glob($this->migrationsPath . '/*.php');
        $pending = [];

        foreach ($files as $file) {
            $migration = basename($file, '.php');

            if (!$this->hasMigrationRun($migration)) {
                $pending[] = basename($file);
            }
        }

        sort($pending);

        return $pending;
    }

    protected function hasMigrationRun($migration) {
        $result = $this->manager->connection()->selectOne(
            'SELECT 1 FROM migrations WHERE migration = ?',
            [$migration]
        );

        return $result !== null;
    }

    protected function recordMigration($migration) {
        $this->manager->connection()->insert(
            'INSERT INTO migrations (migration, batch, created_at, updated_at) VALUES (?, ?, ?, ?)',
            [
                $migration,
                $this->getNextBatch(),
                date('Y-m-d H:i:s'),
                date('Y-m-d H:i:s'),
            ]
        );
    }

    protected function forgetMigration($migration) {
        $this->manager->connection()->delete(
            'DELETE FROM migrations WHERE migration = ?',
            [$migration]
        );
    }

    protected function getLastBatch() {
        $result = $this->manager->connection()->selectOne(
            'SELECT MAX(batch) as batch FROM migrations'
        );

        return $result['batch'] ?? null;
    }

    protected function getNextBatch() {
        $last = $this->getLastBatch();
        return ($last ?? 0) + 1;
    }

    protected function getMigrationsForBatch($batch) {
        return $this->manager->connection()->select(
            'SELECT * FROM migrations WHERE batch = ? ORDER BY migration DESC',
            [$batch]
        );
    }

    protected function getMigrationClassName($file) {
        $file = basename($file, '.php');
        $parts = explode('_', $file);
        
        // Remove timestamp parts (YYYY_MM_DD_HHMMSS)
        for ($i = 0; $i < 4 && !empty($parts); $i++) {
            array_shift($parts);
        }

        return implode('', array_map('ucfirst', $parts));
    }
}

// ============================================
// File: src\Database\Model.php
// ============================================

namespace Framework\Database;

use DateTime;
use Framework\Support\Collection;

/**
 * Base model class with Active Record pattern
 */
abstract class Model
{
    /**
     * Table name (inferred from class name if not set)
     *
     * @var string|null
     */
    protected ?string $table = null;

    /**
     * Primary key column
     *
     * @var string
     */
    protected string $primaryKey = 'id';

    /**
     * Model attributes
     *
     * @var array
     */
    protected array $attributes = [];

    /**
     * Original attributes
     *
     * @var array
     */
    protected array $original = [];

    /**
     * Relationships
     *
     * @var array
     */
    protected array $relations = [];

    /**
     * Fillable attributes
     *
     * @var array
     */
    protected array $fillable = [];

    /**
     * Soft delete column
     *
     * @var string|null
     */
    protected ?string $softDeleteColumn = 'deleted_at';

    /**
     * Get the table name
     *
     * @return string
     */
    public function getTable(): string
    {
        if ($this->table !== null) {
            return $this->table;
        }

        // Infer from class name: User -> users
        $className = class_basename($this);
        return strtolower($className) . 's';
    }

    /**
     * Get a new query builder
     *
     * @return QueryBuilder
     */
    public static function query(): QueryBuilder
    {
        $instance = new static();
        return app(\Framework\Database\Manager::class)->table($instance->getTable());
    }

    /**
     * Get all records
     *
     * @return Collection
     */
    public static function all(): Collection
    {
        return new Collection(static::query()->get());
    }

    /**
     * Find a record by primary key
     *
     * @param mixed $id
     * @return static|null
     */
    public static function find($id): ?static
    {
        $instance = new static();
        $result = static::query()
            ->where($instance->primaryKey, $id)
            ->first();

        if ($result) {
            return $instance->hydrate($result);
        }

        return null;
    }

    /**
     * Find a record or throw exception
     *
     * @param mixed $id
     * @return static
     */
    public static function findOrFail($id): static
    {
        $record = static::find($id);
        if (!$record) {
            abort(404, 'Record not found');
        }
        return $record;
    }

    /**
     * Find by column value
     *
     * @param string $column
     * @param mixed $value
     * @return static|null
     */
    public static function findBy(string $column, $value): ?static
    {
        $instance = new static();
        $result = static::query()
            ->where($column, $value)
            ->first();

        if ($result) {
            return $instance->hydrate($result);
        }

        return null;
    }

    /**
     * Create a new record
     *
     * @param array $attributes
     * @return static
     */
    public static function create(array $attributes): static
    {
        $instance = new static();
        $instance->fill($attributes);
        $instance->save();
        return $instance;
    }

    /**
     * Update or create a record
     *
     * @param array $attributes
     * @param array $values
     * @return static
     */
    public static function updateOrCreate(array $attributes, array $values = []): static
    {
        $record = static::query();

        foreach ($attributes as $key => $value) {
            $record->where($key, $value);
        }

        $result = $record->first();

        if ($result) {
            $instance = (new static())->hydrate($result);
            $instance->fill($values);
            $instance->save();
            return $instance;
        }

        return static::create(array_merge($attributes, $values));
    }

    /**
     * Fill attributes
     *
     * @param array $attributes
     * @return self
     */
    public function fill(array $attributes): self
    {
        foreach ($attributes as $key => $value) {
            if (empty($this->fillable) || in_array($key, $this->fillable)) {
                $this->attributes[$key] = $value;
            }
        }

        return $this;
    }

    /**
     * Hydrate from database result
     *
     * @param array $attributes
     * @return self
     */
    public function hydrate(array $attributes): self
    {
        $this->attributes = $attributes;
        $this->original = $attributes;
        return $this;
    }

    /**
     * Save the model
     *
     * @return bool
     */
    public function save(): bool
    {
        if (isset($this->attributes[$this->primaryKey])) {
            // Update
            $changes = array_diff_assoc($this->attributes, $this->original);
            if (empty($changes)) {
                return true;
            }

            static::query()
                ->where($this->primaryKey, $this->attributes[$this->primaryKey])
                ->update($changes);

            $this->original = $this->attributes;
            return true;
        } else {
            // Insert
            $result = static::query()->insert($this->attributes);

            if ($result) {
                $id = app(\Framework\Database\Manager::class)
                    ->getCurrentConnection()
                    ->lastInsertId();

                $this->attributes[$this->primaryKey] = $id;
                $this->original = $this->attributes;
            }

            return $result;
        }
    }

    /**
     * Delete the model
     *
     * @return bool
     */
    public function delete(): bool
    {
        if ($this->softDeleteColumn && isset($this->attributes[$this->primaryKey])) {
            $this->attributes[$this->softDeleteColumn] = date('Y-m-d H:i:s');
            return $this->save();
        }

        if (isset($this->attributes[$this->primaryKey])) {
            return static::query()
                ->where($this->primaryKey, $this->attributes[$this->primaryKey])
                ->delete() > 0;
        }

        return false;
    }

    /**
     * Restore a soft-deleted model
     *
     * @return bool
     */
    public function restore(): bool
    {
        if ($this->softDeleteColumn && isset($this->attributes[$this->primaryKey])) {
            unset($this->attributes[$this->softDeleteColumn]);
            return $this->save();
        }

        return false;
    }

    /**
     * Force delete (ignore soft deletes)
     *
     * @return bool
     */
    public function forceDelete(): bool
    {
        if (isset($this->attributes[$this->primaryKey])) {
            return static::query()
                ->where($this->primaryKey, $this->attributes[$this->primaryKey])
                ->delete() > 0;
        }

        return false;
    }

    /**
     * Get an attribute
     *
     * @param string $key
     * @return mixed
     */
    public function __get(string $key)
    {
        if (isset($this->attributes[$key])) {
            return $this->attributes[$key];
        }

        if (isset($this->relations[$key])) {
            return $this->relations[$key];
        }

        return null;
    }

    /**
     * Set an attribute
     *
     * @param string $key
     * @param mixed $value
     * @return void
     */
    public function __set(string $key, $value): void
    {
        $this->attributes[$key] = $value;
    }

    /**
     * Check if attribute exists
     *
     * @param string $key
     * @return bool
     */
    public function __isset(string $key): bool
    {
        return isset($this->attributes[$key]) || isset($this->relations[$key]);
    }

    /**
     * Convert to array
     *
     * @return array
     */
    public function toArray(): array
    {
        return array_merge($this->attributes, $this->relations);
    }

    /**
     * Convert to JSON
     *
     * @return string
     */
    public function toJson(): string
    {
        return json_encode($this->toArray());
    }
}

// ============================================
// File: src\Database\QueryBuilder.php
// ============================================

namespace Framework\Database;

/**
 * Fluent SQL query builder
 */
class QueryBuilder
{
    /**
     * Database connection
     *
     * @var Connection
     */
    protected Connection $connection;

    /**
     * Table name
     *
     * @var string
     */
    protected string $table;

    /**
     * SELECT clause columns
     *
     * @var array
     */
    protected array $selects = [];

    /**
     * WHERE conditions
     *
     * @var array
     */
    protected array $wheres = [];

    /**
     * Bindings for query
     *
     * @var array
     */
    protected array $bindings = [];

    /**
     * ORDER BY clauses
     *
     * @var array
     */
    protected array $orders = [];

    /**
     * LIMIT value
     *
     * @var int|null
     */
    protected ?int $limit = null;

    /**
     * OFFSET value
     *
     * @var int|null
     */
    protected ?int $offset = null;

    /**
     * JOIN clauses
     *
     * @var array
     */
    protected array $joins = [];

    /**
     * GROUP BY clauses
     *
     * @var array
     */
    protected array $groups = [];

    /**
     * Create a new query builder
     *
     * @param Connection $connection
     * @param string $table
     */
    public function __construct(Connection $connection, string $table)
    {
        $this->connection = $connection;
        $this->table = $table;
    }

    /**
     * Select columns
     *
     * @param array|string ...$columns
     * @return self
     */
    public function select(...$columns): self
    {
        if (empty($columns)) {
            $columns = ['*'];
        } elseif (count($columns) === 1 && is_array($columns[0])) {
            $columns = $columns[0];
        }

        $this->selects = array_merge($this->selects, $columns);
        return $this;
    }

    /**
     * Add a WHERE condition
     *
     * @param string $column
     * @param string|null $operator
     * @param mixed $value
     * @return self
     */
    public function where(string $column, ?string $operator = null, $value = null): self
    {
        if ($value === null && $operator !== null) {
            $value = $operator;
            $operator = '=';
        }

        $this->wheres[] = [
            'column' => $column,
            'operator' => $operator,
            'value' => $value,
            'boolean' => 'AND',
        ];
        $this->bindings[] = $value;

        return $this;
    }

    /**
     * Add an OR WHERE condition
     *
     * @param string $column
     * @param string|null $operator
     * @param mixed $value
     * @return self
     */
    public function orWhere(string $column, ?string $operator = null, $value = null): self
    {
        if ($value === null && $operator !== null) {
            $value = $operator;
            $operator = '=';
        }

        $this->wheres[] = [
            'column' => $column,
            'operator' => $operator,
            'value' => $value,
            'boolean' => 'OR',
        ];
        $this->bindings[] = $value;

        return $this;
    }

    /**
     * Add a WHERE IN condition
     *
     * @param string $column
     * @param array $values
     * @return self
     */
    public function whereIn(string $column, array $values): self
    {
        if (empty($values)) {
            return $this;
        }

        $placeholders = implode(',', array_fill(0, count($values), '?'));
        $this->wheres[] = [
            'raw' => "{$column} IN ({$placeholders})",
            'boolean' => 'AND',
        ];
        $this->bindings = array_merge($this->bindings, $values);

        return $this;
    }

    /**
     * Add a WHERE NOT IN condition
     *
     * @param string $column
     * @param array $values
     * @return self
     */
    public function whereNotIn(string $column, array $values): self
    {
        if (empty($values)) {
            return $this;
        }

        $placeholders = implode(',', array_fill(0, count($values), '?'));
        $this->wheres[] = [
            'raw' => "{$column} NOT IN ({$placeholders})",
            'boolean' => 'AND',
        ];
        $this->bindings = array_merge($this->bindings, $values);

        return $this;
    }

    /**
     * Add a WHERE NULL condition
     *
     * @param string $column
     * @return self
     */
    public function whereNull(string $column): self
    {
        $this->wheres[] = [
            'raw' => "{$column} IS NULL",
            'boolean' => 'AND',
        ];
        return $this;
    }

    /**
     * Add a WHERE NOT NULL condition
     *
     * @param string $column
     * @return self
     */
    public function whereNotNull(string $column): self
    {
        $this->wheres[] = [
            'raw' => "{$column} IS NOT NULL",
            'boolean' => 'AND',
        ];
        return $this;
    }

    /**
     * Order by a column
     *
     * @param string $column
     * @param string $direction
     * @return self
     */
    public function orderBy(string $column, string $direction = 'ASC'): self
    {
        $this->orders[] = "{$column} {$direction}";
        return $this;
    }

    /**
     * Group by columns
     *
     * @param array|string ...$columns
     * @return self
     */
    public function groupBy(...$columns): self
    {
        if (count($columns) === 1 && is_array($columns[0])) {
            $columns = $columns[0];
        }
        $this->groups = array_merge($this->groups, $columns);
        return $this;
    }

    /**
     * Set the limit
     *
     * @param int $limit
     * @return self
     */
    public function limit(int $limit): self
    {
        $this->limit = $limit;
        return $this;
    }

    /**
     * Set the offset
     *
     * @param int $offset
     * @return self
     */
    public function offset(int $offset): self
    {
        $this->offset = $offset;
        return $this;
    }

    /**
     * Add a join clause
     *
     * @param string $table
     * @param string $on
     * @param string $type
     * @return self
     */
    public function join(string $table, string $on, string $type = 'INNER'): self
    {
        $this->joins[] = "{$type} JOIN {$table} ON {$on}";
        return $this;
    }

    /**
     * Get all records
     *
     * @return array
     */
    public function get(): array
    {
        $query = $this->toSql();
        return $this->connection->select($query, $this->bindings);
    }

    /**
     * Get the first record
     *
     * @return array|null
     */
    public function first(): ?array
    {
        $results = $this->limit(1)->get();
        return $results[0] ?? null;
    }

    /**
     * Count records
     *
     * @return int
     */
    public function count(): int
    {
        $originalSelects = $this->selects;
        $this->selects = ['COUNT(*) as count'];

        $result = $this->first();
        $this->selects = $originalSelects;

        return (int)($result['count'] ?? 0);
    }

    /**
     * Insert a record
     *
     * @param array $values
     * @return bool
     */
    public function insert(array $values): bool
    {
        return $this->connection->insert($this->table, $values);
    }

    /**
     * Update records
     *
     * @param array $values
     * @return int
     */
    public function update(array $values): int
    {
        $where = $this->buildWhereClause();
        return $this->connection->update($this->table, $values, $where, $this->bindings);
    }

    /**
     * Delete records
     *
     * @return int
     */
    public function delete(): int
    {
        $where = $this->buildWhereClause();
        return $this->connection->delete($this->table, $where, $this->bindings);
    }

    /**
     * Build the SQL query
     *
     * @return string
     */
    public function toSql(): string
    {
        $sql = 'SELECT ';

        // Select clause
        if (empty($this->selects)) {
            $sql .= '*';
        } else {
            $sql .= implode(', ', $this->selects);
        }

        $sql .= " FROM {$this->table}";

        // Join clause
        if (!empty($this->joins)) {
            $sql .= ' ' . implode(' ', $this->joins);
        }

        // Where clause
        if (!empty($this->wheres)) {
            $sql .= ' WHERE ' . $this->buildWhereClause();
        }

        // Group by clause
        if (!empty($this->groups)) {
            $sql .= ' GROUP BY ' . implode(', ', $this->groups);
        }

        // Order by clause
        if (!empty($this->orders)) {
            $sql .= ' ORDER BY ' . implode(', ', $this->orders);
        }

        // Limit clause
        if ($this->limit !== null) {
            $sql .= ' LIMIT ' . $this->limit;
        }

        // Offset clause
        if ($this->offset !== null) {
            $sql .= ' OFFSET ' . $this->offset;
        }

        return $sql;
    }

    /**
     * Build the WHERE clause
     *
     * @return string
     */
    protected function buildWhereClause(): string
    {
        $conditions = [];

        foreach ($this->wheres as $where) {
            if (isset($where['raw'])) {
                $conditions[] = $where['raw'];
            } else {
                $conditions[] = "{$where['column']} {$where['operator']} ?";
            }
        }

        $clause = implode(' AND ', $conditions);

        // Handle OR conditions
        $result = '';
        $currentBoolean = 'AND';
        foreach ($this->wheres as $i => $where) {
            if ($i === 0) {
                if (isset($where['raw'])) {
                    $result .= $where['raw'];
                } else {
                    $result .= "{$where['column']} {$where['operator']} ?";
                }
            } else {
                $boolean = $where['boolean'] ?? 'AND';
                if (isset($where['raw'])) {
                    $result .= " {$boolean} {$where['raw']}";
                } else {
                    $result .= " {$boolean} {$where['column']} {$where['operator']} ?";
                }
            }
        }

        return $result;
    }
}

// ============================================
// File: src\Database\Schema\Blueprint.php
// ============================================

namespace Framework\Database\Schema;

class Blueprint {
    protected $table;
    protected $columns = [];
    protected $primaryKeys = [];
    protected $foreignKeys = [];

    public function __construct($table) {
        $this->table = $table;
    }

    public function id() {
        return $this->increments('id')->primary();
    }

    public function increments($column) {
        return $this->addColumn('increments', $column);
    }

    public function string($column, $length = 255) {
        return $this->addColumn('string', $column, ['length' => $length]);
    }

    public function text($column) {
        return $this->addColumn('text', $column);
    }

    public function integer($column) {
        return $this->addColumn('integer', $column);
    }

    public function bigInteger($column) {
        return $this->addColumn('biginteger', $column);
    }

    public function decimal($column, $precision = 8, $scale = 2) {
        return $this->addColumn('decimal', $column, [
            'precision' => $precision,
            'scale' => $scale,
        ]);
    }

    public function boolean($column) {
        return $this->addColumn('boolean', $column);
    }

    public function timestamp($column) {
        return $this->addColumn('timestamp', $column);
    }

    public function timestamps() {
        $this->addColumn('timestamp', 'created_at', ['default' => 'CURRENT_TIMESTAMP']);
        $this->addColumn('timestamp', 'updated_at', ['default' => 'CURRENT_TIMESTAMP']);
    }

    public function softDeletes() {
        return $this->addColumn('timestamp', 'deleted_at', ['nullable' => true]);
    }

    public function date($column) {
        return $this->addColumn('date', $column);
    }

    public function json($column) {
        return $this->addColumn('json', $column);
    }

    public function foreign($column) {
        return new ForeignKeyDefinition($this, $column);
    }

    public function addForeignKey(ForeignKeyDefinition $foreignKey) {
        $this->foreignKeys[] = $foreignKey;
    }

    protected function addColumn($type, $column, $properties = []) {
        $columnDef = new ColumnDefinition($type, $column, $properties);
        $this->columns[] = $columnDef;
        return $columnDef;
    }

    public function primary($columns) {
        if (is_string($columns)) {
            $columns = [$columns];
        }
        $this->primaryKeys = $columns;
    }

    public function getColumns() {
        return $this->columns;
    }

    public function getPrimaryKeys() {
        return $this->primaryKeys;
    }

    public function getForeignKeys() {
        return $this->foreignKeys;
    }

    public function getTable() {
        return $this->table;
    }
}

// ============================================
// File: src\Database\Schema\Builder.php
// ============================================

namespace Framework\Database\Schema;

use Framework\Database\Connection;

class Builder {
    protected $connection;
    protected $blueprint;

    public function __construct(Connection $connection) {
        $this->connection = $connection;
    }

    public function create($table, $callback) {
        $blueprint = new Blueprint($table);
        $callback($blueprint);

        $sql = $this->buildCreateTableSql($blueprint);
        $this->connection->statement($sql);
    }

    public function table($table, $callback) {
        $blueprint = new Blueprint($table);
        $callback($blueprint);

        foreach ($blueprint->getColumns() as $column) {
            $sql = $this->buildAlterTableSql($table, $column);
            $this->connection->statement($sql);
        }
    }

    public function drop($table) {
        $this->connection->statement("DROP TABLE IF EXISTS $table");
    }

    public function dropIfExists($table) {
        $this->drop($table);
    }

    protected function buildCreateTableSql(Blueprint $blueprint) {
        $table = $blueprint->getTable();
        $columnDefinitions = [];

        foreach ($blueprint->getColumns() as $column) {
            $columnDefinitions[] = $this->buildColumnDefinition($column);
        }

        $sql = "CREATE TABLE IF NOT EXISTS $table (" . implode(',', $columnDefinitions);

        if ($primaryKeys = $blueprint->getPrimaryKeys()) {
            $sql .= ", PRIMARY KEY (" . implode(',', $primaryKeys) . ")";
        }

        foreach ($blueprint->getForeignKeys() as $fk) {
            $sql .= ", CONSTRAINT fk_" . $fk->getColumn() . " FOREIGN KEY (" . $fk->getColumn() . ") 
                   REFERENCES " . $fk->getOn() . "(" . $fk->getReferences() . ") 
                   ON DELETE " . $fk->getOnDelete() . " 
                   ON UPDATE " . $fk->getOnUpdate();
        }

        $sql .= ")";

        return $sql;
    }

    protected function buildAlterTableSql($table, $column) {
        return "ALTER TABLE $table ADD " . $this->buildColumnDefinition($column);
    }

    protected function buildColumnDefinition($column) {
        $definition = $column->getName() . ' ' . $this->getColumnType($column);

        if (!$column->isNullable()) {
            $definition .= ' NOT NULL';
        } else {
            $definition .= ' NULL';
        }

        if ($column->isAutoIncrement()) {
            $definition .= ' AUTO_INCREMENT';
        }

        if ($column->getDefault() !== null) {
            if (is_string($column->getDefault())) {
                $definition .= " DEFAULT '" . $column->getDefault() . "'";
            } else {
                $definition .= " DEFAULT " . $column->getDefault();
            }
        }

        if ($column->isUnique()) {
            $definition .= ' UNIQUE';
        }

        return $definition;
    }

    protected function getColumnType($column) {
        $type = $column->getType();
        $properties = $column->getProperties();

        switch ($type) {
            case 'string':
                $length = $properties['length'] ?? 255;
                return "VARCHAR($length)";
            case 'text':
                return 'TEXT';
            case 'integer':
                return 'INTEGER';
            case 'biginteger':
                return 'BIGINT';
            case 'decimal':
                $precision = $properties['precision'] ?? 8;
                $scale = $properties['scale'] ?? 2;
                return "DECIMAL($precision,$scale)";
            case 'boolean':
                return 'BOOLEAN';
            case 'timestamp':
                return 'TIMESTAMP';
            case 'date':
                return 'DATE';
            case 'json':
                return 'JSON';
            case 'increments':
                return 'INTEGER AUTO_INCREMENT';
            default:
                return 'VARCHAR(255)';
        }
    }
}

// ============================================
// File: src\Database\Schema\ColumnDefinition.php
// ============================================

namespace Framework\Database\Schema;

class ColumnDefinition {
    protected $type;
    protected $name;
    protected $properties = [];
    protected $isNullable = false;
    protected $isPrimary = false;
    protected $isUnique = false;
    protected $defaultValue;
    protected $autoIncrement = false;

    public function __construct($type, $name, $properties = []) {
        $this->type = $type;
        $this->name = $name;
        $this->properties = $properties;
    }

    public function nullable() {
        $this->isNullable = true;
        return $this;
    }

    public function primary() {
        $this->isPrimary = true;
        return $this;
    }

    public function unique() {
        $this->isUnique = true;
        return $this;
    }

    public function default($value) {
        $this->defaultValue = $value;
        return $this;
    }

    public function autoIncrement() {
        $this->autoIncrement = true;
        return $this;
    }

    public function getType() {
        return $this->type;
    }

    public function getName() {
        return $this->name;
    }

    public function getProperties() {
        return $this->properties;
    }

    public function isNullable() {
        return $this->isNullable;
    }

    public function isPrimary() {
        return $this->isPrimary;
    }

    public function isUnique() {
        return $this->isUnique;
    }

    public function getDefault() {
        return $this->defaultValue;
    }

    public function isAutoIncrement() {
        return $this->autoIncrement;
    }
}

// ============================================
// File: src\Database\Schema\ForeignKeyDefinition.php
// ============================================

namespace Framework\Database\Schema;

class ForeignKeyDefinition {
    protected $blueprint;
    protected $column;
    protected $references;
    protected $on;
    protected $onDelete = 'NO ACTION';
    protected $onUpdate = 'NO ACTION';

    public function __construct(Blueprint $blueprint, $column) {
        $this->blueprint = $blueprint;
        $this->column = $column;
    }

    public function references($column) {
        $this->references = $column;
        return $this;
    }

    public function on($table) {
        $this->on = $table;
        $this->blueprint->addForeignKey($this);
        return $this;
    }

    public function onDelete($action) {
        $this->onDelete = $action;
        return $this;
    }

    public function onUpdate($action) {
        $this->onUpdate = $action;
        return $this;
    }

    public function getColumn() {
        return $this->column;
    }

    public function getReferences() {
        return $this->references;
    }

    public function getOn() {
        return $this->on;
    }

    public function getOnDelete() {
        return $this->onDelete;
    }

    public function getOnUpdate() {
        return $this->onUpdate;
    }
}

// ============================================
// File: src\Database\SqlLoader.php
// ============================================

namespace Framework\Database;

class SqlLoader {
    protected $sqlPath;
    protected $connection;

    public function __construct(Connection $connection, $sqlPath = null) {
        $this->connection = $connection;
        $this->sqlPath = $sqlPath ?? __DIR__ . '/sql';
    }

    public function execute($file, $bindings = []) {
        $sql = $this->load($file);
        return $this->connection->query($sql, $bindings);
    }

    public function query($file, $bindings = []) {
        $sql = $this->load($file);
        return $this->connection->sql($sql, $bindings);
    }

    public function select($file, $bindings = []) {
        return $this->query($file, $bindings);
    }

    public function insert($file, $bindings = []) {
        return $this->execute($file, $bindings);
    }

    public function update($file, $bindings = []) {
        return $this->execute($file, $bindings);
    }

    public function delete($file, $bindings = []) {
        return $this->execute($file, $bindings);
    }

    public function load($file) {
        $path = $this->getPath($file);

        if (!file_exists($path)) {
            throw new \Exception("SQL file not found: $file at $path");
        }

        $sql = file_get_contents($path);

        if (!$sql) {
            throw new \Exception("SQL file is empty: $file");
        }

        return trim($sql);
    }

    protected function getPath($file) {
        $file = ltrim($file, '/');

        if (!str_ends_with($file, '.sql')) {
            $file .= '.sql';
        }

        return $this->sqlPath . '/' . $file;
    }

    public function exists($file) {
        return file_exists($this->getPath($file));
    }

    public function all() {
        if (!is_dir($this->sqlPath)) {
            return [];
        }

        $files = glob($this->sqlPath . '/*.sql');
        return array_map('basename', $files);
    }
}

// ============================================
// File: src\Env\DotEnv.php
// ============================================

namespace Framework\Env;

/**
 * Environment variable loader from .env files
 */
class DotEnv
{
    /**
     * Path to .env file
     *
     * @var string
     */
    protected string $path;

    /**
     * Create a new DotEnv instance
     *
     * @param string $path
     */
    public function __construct(string $path)
    {
        $this->path = $path;
    }

    /**
     * Load the .env file
     *
     * @return void
     */
    public function load(): void
    {
        if (!file_exists($this->path)) {
            return;
        }

        $lines = file($this->path, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);

        foreach ($lines as $line) {
            // Skip comments
            if (str_starts_with(trim($line), '#')) {
                continue;
            }

            // Parse line
            if (str_contains($line, '=')) {
                [$key, $value] = explode('=', $line, 2);
                $key = trim($key);
                $value = trim($value);

                // Remove quotes
                if (str_starts_with($value, '"') && str_ends_with($value, '"')) {
                    $value = substr($value, 1, -1);
                } elseif (str_starts_with($value, "'") && str_ends_with($value, "'")) {
                    $value = substr($value, 1, -1);
                }

                // Set environment variable
                $_ENV[$key] = $value;
                putenv("{$key}={$value}");
            }
        }
    }
}

// ============================================
// File: src\Env\Loader.php
// ============================================

namespace Framework\Env;

class Loader {
    protected $variables = [];

    public function __construct($file = null) {
        if ($file && file_exists($file)) {
            $this->load($file);
        }
    }

    public function load($file = null) {
        if ($file === null) {
            $file = FRAMEWORK_PATH . '/.env';
        }

        if (!file_exists($file)) {
            return;
        }

        $lines = file($file, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);

        foreach ($lines as $line) {
            if (strpos(trim($line), '#') === 0) {
                continue;
            }

            if (strpos($line, '=') === false) {
                continue;
            }

            list($key, $value) = explode('=', $line, 2);

            $key = trim($key);
            $value = trim($value);

            $value = $this->parseValue($value);

            $this->variables[$key] = $value;
            putenv("$key=$value");
            $_ENV[$key] = $value;
        }
    }

    protected function parseValue($value) {
        if (in_array($value, ['true', 'false'])) {
            return $value === 'true';
        }

        if (is_numeric($value)) {
            return strpos($value, '.') !== false ? (float)$value : (int)$value;
        }

        if (($value[0] ?? null) === '"' && ($value[-1] ?? null) === '"') {
            return substr($value, 1, -1);
        }

        return $value;
    }

    public function get($key, $default = null) {
        return $this->variables[$key] ?? $_ENV[$key] ?? getenv($key) ?: $default;
    }

    public function has($key) {
        return isset($this->variables[$key]) || isset($_ENV[$key]) || getenv($key) !== false;
    }
}

// ============================================
// File: src\Events\Dispatcher.php
// ============================================

namespace Framework\Events;

class Dispatcher {
    protected $listeners = [];

    public function listen($event, $listener) {
        if (!isset($this->listeners[$event])) {
            $this->listeners[$event] = [];
        }

        $this->listeners[$event][] = $listener;

        return $this;
    }

    public function dispatch($event, $data = null) {
        $eventName = is_string($event) ? $event : get_class($event);

        if (!isset($this->listeners[$eventName])) {
            return;
        }

        foreach ($this->listeners[$eventName] as $listener) {
            if (is_string($listener)) {
                $listener = app($listener);
            }

            if (is_callable($listener)) {
                call_user_func($listener, $data ?? $event);
            } elseif (method_exists($listener, 'handle')) {
                $listener->handle($data ?? $event);
            }
        }
    }

    public function hasListeners($event) {
        return isset($this->listeners[$event]);
    }

    public function getListeners($event) {
        return $this->listeners[$event] ?? [];
    }
}

// ============================================
// File: src\Exception\HttpException.php
// ============================================

namespace Framework\Exception;

/**
 * HTTP exception for abort() calls
 */
class HttpException extends \Exception
{
    /**
     * HTTP status code
     *
     * @var int
     */
    protected int $status;

    /**
     * Create a new HTTP exception
     *
     * @param int $status
     * @param string $message
     */
    public function __construct(int $status = 500, string $message = '')
    {
        $this->status = $status;
        parent::__construct($message);
    }

    /**
     * Get the status code
     *
     * @return int
     */
    public function getStatus(): int
    {
        return $this->status;
    }
}

// ============================================
// File: src\Exceptions\Handler.php
// ============================================

namespace Framework\Exceptions;

class Handler {
    protected $dontReport = [];
    protected $render = [];

    public function report(\Exception $exception) {
        if ($this->shouldntReport($exception)) {
            return;
        }

        app('logger')->error('Exception: ' . $exception->getMessage(), [
            'exception' => get_class($exception),
            'file' => $exception->getFile(),
            'line' => $exception->getLine(),
            'trace' => $exception->getTraceAsString(),
        ]);
    }

    public function render($request, \Exception $exception) {
        if (env('APP_DEBUG', false)) {
            return $this->renderDebug($exception);
        }

        return $this->renderProduction($exception);
    }

    protected function renderDebug(\Exception $exception) {
        return new \Framework\Http\Response(
            $this->formatDebugError($exception),
            500,
            ['Content-Type' => 'text/html; charset=UTF-8']
        );
    }

    protected function renderProduction(\Exception $exception) {
        return new \Framework\Http\Response(
            'Internal Server Error',
            500,
            ['Content-Type' => 'text/plain']
        );
    }

    protected function formatDebugError(\Exception $exception) {
        $html = '<html><head><title>Error</title></head><body style="font-family: monospace; margin: 20px;">';
        $html .= '<h1 style="color: #d32f2f;">' . get_class($exception) . '</h1>';
        $html .= '<p style="color: #666; font-size: 14px;">' . $exception->getMessage() . '</p>';
        $html .= '<p style="color: #999; font-size: 12px;">' . $exception->getFile() . ':' . $exception->getLine() . '</p>';
        $html .= '<pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto;">';
        $html .= htmlspecialchars($exception->getTraceAsString());
        $html .= '</pre>';
        $html .= '</body></html>';

        return $html;
    }

    protected function shouldntReport(\Exception $exception) {
        foreach ($this->dontReport as $class) {
            if ($exception instanceof $class) {
                return true;
            }
        }

        return false;
    }
}

// ============================================
// File: src\Exceptions\HttpException.php
// ============================================

namespace Framework\Exceptions;

class HttpException extends \Exception {
    protected $statusCode;

    public function __construct($statusCode = 500, $message = null) {
        $this->statusCode = $statusCode;

        if ($message === null) {
            $message = $this->getDefaultMessage($statusCode);
        }

        parent::__construct($message, $statusCode);
    }

    public function getStatusCode() {
        return $this->statusCode;
    }

    protected function getDefaultMessage($code) {
        $messages = [
            400 => 'Bad Request',
            401 => 'Unauthorized',
            403 => 'Forbidden',
            404 => 'Not Found',
            405 => 'Method Not Allowed',
            422 => 'Unprocessable Entity',
            500 => 'Internal Server Error',
            503 => 'Service Unavailable',
        ];

        return $messages[$code] ?? 'Error';
    }
}

// ============================================
// File: src\Exceptions\ValidationException.php
// ============================================

namespace Framework\Exceptions;

class ValidationException extends \Exception {
    protected $errors = [];

    public function __construct($errors = []) {
        $this->errors = $errors;
        parent::__construct('Validation failed');
    }

    public function getErrors() {
        return $this->errors;
    }

    public function errors() {
        return $this->errors;
    }
}

// ============================================
// File: src\Filesystem\File.php
// ============================================

namespace Framework\Filesystem;

class File {
    protected $path;

    public function __construct($path) {
        $this->path = $path;
    }

    public static function exists($path) {
        return file_exists($path);
    }

    public static function get($path) {
        if (!file_exists($path)) {
            throw new \Exception("File not found: $path");
        }

        return file_get_contents($path);
    }

    public static function put($path, $contents) {
        $directory = dirname($path);

        if (!is_dir($directory)) {
            mkdir($directory, 0755, true);
        }

        return file_put_contents($path, $contents);
    }

    public static function append($path, $contents) {
        return file_put_contents($path, $contents, FILE_APPEND);
    }

    public static function delete($path) {
        if (file_exists($path)) {
            return unlink($path);
        }

        return false;
    }

    public static function move($from, $to) {
        $directory = dirname($to);

        if (!is_dir($directory)) {
            mkdir($directory, 0755, true);
        }

        return rename($from, $to);
    }

    public static function copy($from, $to) {
        $directory = dirname($to);

        if (!is_dir($directory)) {
            mkdir($directory, 0755, true);
        }

        return copy($from, $to);
    }

    public static function makeDirectory($path) {
        return mkdir($path, 0755, true);
    }

    public static function isDirectory($path) {
        return is_dir($path);
    }

    public static function isFile($path) {
        return is_file($path);
    }

    public static function extension($path) {
        return pathinfo($path, PATHINFO_EXTENSION);
    }

    public static function name($path) {
        return pathinfo($path, PATHINFO_FILENAME);
    }

    public static function basename($path) {
        return basename($path);
    }

    public static function dirname($path) {
        return dirname($path);
    }

    public static function size($path) {
        return filesize($path);
    }

    public static function lastModified($path) {
        return filemtime($path);
    }

    public static function glob($pattern) {
        return glob($pattern);
    }

    public static function listDirectory($path) {
        return array_diff(scandir($path), ['.', '..']);
    }
}

// ============================================
// File: src\Foundation\Application.php
// ============================================

namespace Framework\Foundation;

use Framework\Container\Container;
use Framework\Config\Repository;
use Framework\Env\Loader;
use Framework\Routing\Router;
use Framework\View\Factory;
use Framework\Database\Manager;
use Framework\Events\Dispatcher;
use Framework\Middleware\Stack;
use Framework\Logging\Logger;

class Application extends Container {
    protected $path;
    protected $booted = false;
    protected $serviceProviders = [];
    protected $deferredServices = [];

    public function __construct($basePath) {
        parent::__construct();
        $this->path = $basePath;
        $this->registerBaseBindings();
    }

    protected function registerBaseBindings() {
        $this->instance('app', $this);
        $this->instance('path', $this->path);
    }

    public function loadEnvironment() {
        $envFile = $this->path . '/.env';
        if (file_exists($envFile)) {
            $loader = new Loader($envFile);
            $loader->load();
        }
    }

    public function registerCoreServices() {
        $this->singleton('config', function ($app) {
            return new Repository();
        });

        $this->singleton('env', function ($app) {
            return new Loader();
        });

        $this->singleton('router', function ($app) {
            return new Router();
        });

        $this->singleton('view', function ($app) {
            return new Factory($app['config']);
        });

        $this->singleton('db', function ($app) {
            return new Manager($app['config']->get('database'));
        });

        $this->singleton('events', function ($app) {
            return new Dispatcher();
        });

        $this->singleton('middleware', function ($app) {
            return new Stack();
        });

        $this->singleton('logger', function ($app) {
            return new Logger($app['config']->get('logging'));
        });
    }

    public function loadConfiguration() {
        $configPath = CONFIG_PATH;
        
        if (is_dir($configPath)) {
            foreach (glob($configPath . '/*.php') as $file) {
                $key = basename($file, '.php');
                $config = include $file;
                $this['config']->set($key, $config);
            }
        }
    }

    public function registerServiceProviders() {
        $providers = config('app.providers', []);
        
        foreach ($providers as $provider) {
            $this->registerServiceProvider($provider);
        }
    }

    public function registerServiceProvider($provider) {
        if (is_string($provider)) {
            $provider = new $provider($this);
        }

        if (method_exists($provider, 'register')) {
            $provider->register();
        }

        $this->serviceProviders[] = $provider;
    }

    public function bootProviders() {
        foreach ($this->serviceProviders as $provider) {
            if (method_exists($provider, 'boot')) {
                $provider->boot();
            }
        }
        $this->booted = true;
    }

    public function handle($method, $uri, $query = [], $post = [], $server = [], $cookies = []) {
        $route = $this['router']->match($method, $uri);

        if (!$route) {
            return new \Framework\Http\Response('Not Found', 404);
        }

        $controller = $route->getController();
        $method = $route->getMethod();
        $params = $route->getParameters();

        if (is_string($controller)) {
            list($class, $method) = explode('@', $controller);
            $controller = $this->make($class);
        }

        $request = new \Framework\Http\Request($method, $uri, $query, $post, $server, $cookies);
        
        try {
            $result = call_user_func_array([$controller, $method], array_values($params));
            
            if (is_string($result)) {
                return new \Framework\Http\Response($result);
            }
            
            if ($result instanceof \Framework\Http\Response) {
                return $result;
            }

            if (is_array($result)) {
                return new \Framework\Http\Response(json_encode($result), 200, ['Content-Type' => 'application/json']);
            }

            return new \Framework\Http\Response((string)$result);
        } catch (\Exception $e) {
            return $this->handleException($e);
        }
    }

    protected function handleException(\Exception $e) {
        $this['logger']->error('Exception: ' . $e->getMessage());
        
        if (env('APP_DEBUG', false)) {
            return new \Framework\Http\Response(
                "<pre>" . $e->getMessage() . "\n\n" . $e->getTraceAsString() . "</pre>",
                500,
                ['Content-Type' => 'text/html']
            );
        }

        return new \Framework\Http\Response('Internal Server Error', 500);
    }

    public function isBooted() {
        return $this->booted;
    }
}

// ============================================
// File: src\Foundation\Controller.php
// ============================================

namespace Framework\Foundation;

use Framework\Http\Request;
use Framework\Http\Response;
use Framework\Validation\Validator;

/**
 * Base controller class
 */
abstract class Controller
{
    /**
     * Current request
     *
     * @var Request
     */
    protected Request $request;

    /**
     * Middleware
     *
     * @var array
     */
    protected array $middleware = [];

    /**
     * Constructor
     */
    public function __construct()
    {
        $this->request = app(Request::class);
    }

    /**
     * Get middleware
     *
     * @return array
     */
    public function getMiddleware(): array
    {
        return $this->middleware;
    }

    /**
     * Validate request data
     *
     * @param array $rules
     * @return array
     */
    public function validate(array $rules): array
    {
        $validator = new Validator($this->request->all(), $rules);
        
        if ($validator->fails()) {
            session()->put('errors', $validator->errors());
            session()->put('old_input', $this->request->all());
            abort(422, 'Validation failed');
        }

        return $validator->validated();
    }

    /**
     * Render a view
     *
     * @param string $name
     * @param array $data
     * @return Response
     */
    public function view(string $name, array $data = []): Response
    {
        $content = view($name, $data)->render();
        return response($content);
    }

    /**
     * Return JSON response
     *
     * @param mixed $data
     * @param int $status
     * @return Response
     */
    public function json($data, int $status = 200): Response
    {
        return json_response($data, $status);
    }

    /**
     * Redirect to route
     *
     * @param string $route
     * @param array $parameters
     * @return Response
     */
    public function redirectToRoute(string $route, array $parameters = []): Response
    {
        return redirect(route($route, $parameters));
    }

    /**
     * Redirect back
     *
     * @return Response
     */
    public function back(): Response
    {
        return back();
    }

    /**
     * Get current user
     *
     * @return mixed
     */
    public function user()
    {
        return auth()->user();
    }

    /**
     * Check if user is authenticated
     *
     * @return bool
     */
    public function isAuthenticated(): bool
    {
        return auth()->check();
    }
}

// ============================================
// File: src\Http\JsonResponse.php
// ============================================

namespace Framework\Http;

/**
 * JSON Response object
 */
class JsonResponse extends Response
{
    /**
     * Create a new JSON response
     *
     * @param mixed $data
     * @param int $status
     * @param array $headers
     */
    public function __construct($data = [], int $status = 200, array $headers = [])
    {
        $headers['Content-Type'] = 'application/json';
        parent::__construct(json_encode($data, JSON_UNESCAPED_SLASHES | JSON_PRETTY_PRINT), $status, $headers);
    }
}

// ============================================
// File: src\Http\Request.php
// ============================================

namespace Framework\Http;

/**
 * HTTP Request object
 * 
 * Encapsulates the current HTTP request with input handling and validation
 */
class Request
{
    /**
     * HTTP method
     *
     * @var string
     */
    protected string $method;

    /**
     * Request URI
     *
     * @var string
     */
    protected string $uri;

    /**
     * Request path
     *
     * @var string
     */
    protected string $path;

    /**
     * Query parameters
     *
     * @var array
     */
    protected array $query;

    /**
     * Post/Form data
     *
     * @var array
     */
    protected array $post;

    /**
     * Files
     *
     * @var array
     */
    protected array $files;

    /**
     * Server data
     *
     * @var array
     */
    protected array $server;

    /**
     * Headers
     *
     * @var array
     */
    protected array $headers;

    /**
     * Create a new request instance
     */
    public function __construct()
    {
        $this->method = $_SERVER['REQUEST_METHOD'] ?? 'GET';
        $this->query = $_GET;
        $this->post = $_POST;
        $this->files = $_FILES;
        $this->server = $_SERVER;

        $this->parseUri();
        $this->parseHeaders();
    }

    /**
     * Parse the URI and path
     *
     * @return void
     */
    protected function parseUri(): void
    {
        $this->uri = $_SERVER['REQUEST_URI'] ?? '/';
        
        // Remove query string
        if (strpos($this->uri, '?') !== false) {
            $this->path = substr($this->uri, 0, strpos($this->uri, '?'));
        } else {
            $this->path = $this->uri;
        }

        // Remove leading slash if present
        if ($this->path !== '/' && str_starts_with($this->path, '/')) {
            $this->path = substr($this->path, 1);
        }
    }

    /**
     * Parse headers from server
     *
     * @return void
     */
    protected function parseHeaders(): void
    {
        $this->headers = [];

        foreach ($this->server as $key => $value) {
            if (str_starts_with($key, 'HTTP_')) {
                $header = substr($key, 5);
                $header = str_replace('_', '-', strtolower($header));
                $this->headers[$header] = $value;
            }
        }
    }

    /**
     * Get the HTTP method
     *
     * @return string
     */
    public function method(): string
    {
        return $this->method;
    }

    /**
     * Check if request method is GET
     *
     * @return bool
     */
    public function isGet(): bool
    {
        return $this->method === 'GET';
    }

    /**
     * Check if request method is POST
     *
     * @return bool
     */
    public function isPost(): bool
    {
        return $this->method === 'POST';
    }

    /**
     * Check if request is AJAX
     *
     * @return bool
     */
    public function isAjax(): bool
    {
        return strtolower($this->header('x-requested-with')) === 'xmlhttprequest';
    }

    /**
     * Get the request path
     *
     * @return string
     */
    public function path(): string
    {
        return $this->path ?: '/';
    }

    /**
     * Get the full URI
     *
     * @return string
     */
    public function uri(): string
    {
        return $this->uri;
    }

    /**
     * Get an input value
     *
     * @param string $key
     * @param mixed $default
     * @return mixed
     */
    public function input(string $key, $default = null)
    {
        return $this->post[$key] ?? $this->query[$key] ?? $default;
    }

    /**
     * Get all input data
     *
     * @return array
     */
    public function all(): array
    {
        return array_merge($this->query, $this->post);
    }

    /**
     * Get query parameters
     *
     * @return array
     */
    public function query(): array
    {
        return $this->query;
    }

    /**
     * Get post data
     *
     * @return array
     */
    public function post(): array
    {
        return $this->post;
    }

    /**
     * Get files
     *
     * @return array
     */
    public function files(): array
    {
        return $this->files;
    }

    /**
     * Get a file
     *
     * @param string $name
     * @return array|null
     */
    public function file(string $name): ?array
    {
        return $this->files[$name] ?? null;
    }

    /**
     * Get a header
     *
     * @param string $name
     * @param string|null $default
     * @return string|null
     */
    public function header(string $name, ?string $default = null): ?string
    {
        return $this->headers[strtolower($name)] ?? $default;
    }

    /**
     * Get all headers
     *
     * @return array
     */
    public function headers(): array
    {
        return $this->headers;
    }

    /**
     * Check if input key exists
     *
     * @param string $key
     * @return bool
     */
    public function has(string $key): bool
    {
        return isset($this->post[$key]) || isset($this->query[$key]);
    }

    /**
     * Get input as array
     *
     * @param array $keys
     * @return array
     */
    public function only(array $keys): array
    {
        $result = [];
        foreach ($keys as $key) {
            if ($this->has($key)) {
                $result[$key] = $this->input($key);
            }
        }
        return $result;
    }

    /**
     * Get IP address
     *
     * @return string
     */
    public function ip(): string
    {
        if (!empty($_SERVER['HTTP_CLIENT_IP'])) {
            $ip = $_SERVER['HTTP_CLIENT_IP'];
        } elseif (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) {
            $ip = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR'])[0];
        } else {
            $ip = $_SERVER['REMOTE_ADDR'] ?? '0.0.0.0';
        }
        return trim($ip);
    }

    /**
     * Get user agent
     *
     * @return string
     */
    public function userAgent(): string
    {
        return $_SERVER['HTTP_USER_AGENT'] ?? '';
    }
}

// ============================================
// File: src\Http\Response.php
// ============================================

namespace Framework\Http;

/**
 * HTTP Response object
 */
class Response
{
    /**
     * Response content
     *
     * @var string
     */
    protected string $content;

    /**
     * HTTP status code
     *
     * @var int
     */
    protected int $status;

    /**
     * Response headers
     *
     * @var array
     */
    protected array $headers;

    /**
     * Create a new response
     *
     * @param mixed $content
     * @param int $status
     * @param array $headers
     */
    public function __construct($content = '', int $status = 200, array $headers = [])
    {
        $this->content = (string)$content;
        $this->status = $status;
        $this->headers = $headers;
    }

    /**
     * Get the content
     *
     * @return string
     */
    public function getContent(): string
    {
        return $this->content;
    }

    /**
     * Set the content
     *
     * @param string $content
     * @return self
     */
    public function setContent(string $content): self
    {
        $this->content = $content;
        return $this;
    }

    /**
     * Get the status code
     *
     * @return int
     */
    public function getStatus(): int
    {
        return $this->status;
    }

    /**
     * Set the status code
     *
     * @param int $status
     * @return self
     */
    public function setStatus(int $status): self
    {
        $this->status = $status;
        return $this;
    }

    /**
     * Get a header
     *
     * @param string $name
     * @return string|null
     */
    public function getHeader(string $name): ?string
    {
        return $this->headers[$name] ?? null;
    }

    /**
     * Set a header
     *
     * @param string $name
     * @param string $value
     * @return self
     */
    public function setHeader(string $name, string $value): self
    {
        $this->headers[$name] = $value;
        return $this;
    }

    /**
     * Get all headers
     *
     * @return array
     */
    public function getHeaders(): array
    {
        return $this->headers;
    }

    /**
     * Send the response
     *
     * @return void
     */
    public function send(): void
    {
        // Send status code
        http_response_code($this->status);

        // Send headers
        foreach ($this->headers as $name => $value) {
            header("{$name}: {$value}");
        }

        // Send content
        echo $this->content;
    }

    /**
     * Convert to string
     *
     * @return string
     */
    public function __toString(): string
    {
        return $this->content;
    }
}

// ============================================
// File: src\Logging\Logger.php
// ============================================

namespace Framework\Logging;

/**
 * File-based structured logger
 */
class Logger
{
    /**
     * Log file path
     *
     * @var string
     */
    protected string $path;

    /**
     * Log levels
     *
     * @var array
     */
    protected array $levels = ['debug', 'info', 'notice', 'warning', 'error', 'critical', 'alert', 'emergency'];

    /**
     * Create a new logger
     *
     * @param string $path
     */
    public function __construct(string $path = '')
    {
        $this->path = $path ?: storage_path('logs/app.log');
        $this->ensureLogDirectory();
    }

    /**
     * Ensure log directory exists
     *
     * @return void
     */
    protected function ensureLogDirectory(): void
    {
        $dir = dirname($this->path);
        if (!is_dir($dir)) {
            mkdir($dir, 0755, true);
        }
    }

    /**
     * Log a debug message
     *
     * @param string $message
     * @param array $context
     * @return void
     */
    public function debug(string $message, array $context = []): void
    {
        $this->log('DEBUG', $message, $context);
    }

    /**
     * Log an info message
     *
     * @param string $message
     * @param array $context
     * @return void
     */
    public function info(string $message, array $context = []): void
    {
        $this->log('INFO', $message, $context);
    }

    /**
     * Log a notice message
     *
     * @param string $message
     * @param array $context
     * @return void
     */
    public function notice(string $message, array $context = []): void
    {
        $this->log('NOTICE', $message, $context);
    }

    /**
     * Log a warning message
     *
     * @param string $message
     * @param array $context
     * @return void
     */
    public function warning(string $message, array $context = []): void
    {
        $this->log('WARNING', $message, $context);
    }

    /**
     * Log an error message
     *
     * @param string $message
     * @param array $context
     * @return void
     */
    public function error(string $message, array $context = []): void
    {
        $this->log('ERROR', $message, $context);
    }

    /**
     * Log a critical message
     *
     * @param string $message
     * @param array $context
     * @return void
     */
    public function critical(string $message, array $context = []): void
    {
        $this->log('CRITICAL', $message, $context);
    }

    /**
     * Log an alert message
     *
     * @param string $message
     * @param array $context
     * @return void
     */
    public function alert(string $message, array $context = []): void
    {
        $this->log('ALERT', $message, $context);
    }

    /**
     * Log an emergency message
     *
     * @param string $message
     * @param array $context
     * @return void
     */
    public function emergency(string $message, array $context = []): void
    {
        $this->log('EMERGENCY', $message, $context);
    }

    /**
     * Log a message
     *
     * @param string $level
     * @param string $message
     * @param array $context
     * @return void
     */
    protected function log(string $level, string $message, array $context = []): void
    {
        $timestamp = date('Y-m-d H:i:s');
        $contextStr = !empty($context) ? ' ' . json_encode($context) : '';
        $entry = "[{$timestamp}] [{$level}] {$message}{$contextStr}" . PHP_EOL;

        file_put_contents($this->path, $entry, FILE_APPEND);
    }

    /**
     * Get log contents
     *
     * @return string
     */
    public function getContents(): string
    {
        if (!file_exists($this->path)) {
            return '';
        }

        return file_get_contents($this->path);
    }

    /**
     * Clear log file
     *
     * @return void
     */
    public function clear(): void
    {
        if (file_exists($this->path)) {
            file_put_contents($this->path, '');
        }
    }
}

// ============================================
// File: src\Middleware\Middleware.php
// ============================================

namespace Framework\Middleware;

abstract class Middleware {
    public abstract function handle($request, $next);
}

// ============================================
// File: src\Middleware\Stack.php
// ============================================

namespace Framework\Middleware;

use Framework\Http\Request;
use Framework\Http\Response;

/**
 * Middleware pipeline/stack
 */
class Stack
{
    /**
     * Middleware stack
     *
     * @var array
     */
    protected array $middleware = [];

    /**
     * Final handler
     *
     * @var callable|null
     */
    protected $finalHandler = null;

    /**
     * Add middleware to the stack
     *
     * @param string|callable $middleware
     * @return self
     */
    public function add($middleware): self
    {
        $this->middleware[] = $middleware;
        return $this;
    }

    /**
     * Set the final handler
     *
     * @param callable $handler
     * @return self
     */
    public function then(callable $handler): self
    {
        $this->finalHandler = $handler;
        return $this;
    }

    /**
     * Execute the middleware stack
     *
     * @param Request $request
     * @return Response
     */
    public function execute(Request $request): Response
    {
        $middlewares = array_reverse($this->middleware);

        $next = $this->finalHandler ?? function ($request) {
            return new Response('No handler defined');
        };

        foreach ($middlewares as $middleware) {
            $next = $this->wrap($middleware, $next);
        }

        return $next($request);
    }

    /**
     * Wrap a middleware
     *
     * @param string|callable $middleware
     * @param callable $next
     * @return callable
     */
    protected function wrap($middleware, callable $next): callable
    {
        return function (Request $request) use ($middleware, $next) {
            if (is_string($middleware)) {
                $middleware = app($middleware);
            }

            if (is_callable($middleware)) {
                return $middleware($request, $next);
            }

            if (method_exists($middleware, 'handle')) {
                return $middleware->handle($request, $next);
            }

            return $next($request);
        };
    }
}

// ============================================
// File: src\Notifications\Channels\DatabaseChannel.php
// ============================================

namespace Framework\Notifications\Channels;

class DatabaseChannel {
    public function send($notifiable, $notification) {
        $message = $notification->toDatabase();

        if (method_exists($notifiable, 'notify')) {
            app('db')->table('notifications')->insert([
                'notifiable_id' => $notifiable->getAttribute('id'),
                'notifiable_type' => get_class($notifiable),
                'type' => get_class($notification),
                'data' => json_encode($message),
                'read_at' => null,
                'created_at' => date('Y-m-d H:i:s'),
            ]);
        }
    }
}

// ============================================
// File: src\Notifications\Channels\MailChannel.php
// ============================================

namespace Framework\Notifications\Channels;

class MailChannel {
    public function send($notifiable, $notification) {
        $message = $notification->toMail();

        if (empty($notifiable->getAttribute('email'))) {
            return;
        }

        $to = $notifiable->getAttribute('email');
        $subject = $message['subject'] ?? 'Notification';
        $body = $message['body'] ?? '';

        mail($to, $subject, $body);
    }
}

// ============================================
// File: src\Notifications\Notification.php
// ============================================

namespace Framework\Notifications;

abstract class Notification {
    protected $data = [];

    public function __construct($data = []) {
        $this->data = $data;
    }

    abstract public function via();

    abstract public function toMail();

    abstract public function toDatabase();

    public function getData() {
        return $this->data;
    }
}

// ============================================
// File: src\Pagination\Paginator.php
// ============================================

namespace Framework\Pagination;

class Paginator {
    protected $items;
    protected $perPage;
    protected $currentPage;
    protected $totalItems;

    public function __construct($items, $perPage = 15, $currentPage = 1) {
        $this->items = $items;
        $this->perPage = $perPage;
        $this->currentPage = max(1, intval($currentPage));
        $this->totalItems = count($items);
    }

    public function getItems() {
        $offset = ($this->currentPage - 1) * $this->perPage;
        return array_slice($this->items, $offset, $this->perPage);
    }

    public function getCurrentPage() {
        return $this->currentPage;
    }

    public function getPerPage() {
        return $this->perPage;
    }

    public function getTotalItems() {
        return $this->totalItems;
    }

    public function getTotalPages() {
        return ceil($this->totalItems / $this->perPage);
    }

    public function hasPages() {
        return $this->getTotalPages() > 1;
    }

    public function hasMore() {
        return $this->currentPage < $this->getTotalPages();
    }

    public function hasPrevious() {
        return $this->currentPage > 1;
    }

    public function nextPage() {
        return $this->hasMore() ? $this->currentPage + 1 : null;
    }

    public function previousPage() {
        return $this->hasPrevious() ? $this->currentPage - 1 : null;
    }

    public function render($baseUrl = '') {
        if (!$this->hasPages()) {
            return '';
        }

        $html = '<nav class="pagination">';
        $html .= '<ul>';

        if ($this->hasPrevious()) {
            $prevPage = $this->previousPage();
            $html .= '<li><a href="' . $baseUrl . '?page=' . $prevPage . '">Previous</a></li>';
        }

        for ($i = 1; $i <= $this->getTotalPages(); $i++) {
            $active = $i === $this->currentPage ? ' active' : '';
            $html .= '<li><a href="' . $baseUrl . '?page=' . $i . '"' . ($active ? ' class="' . $active . '"' : '') . '>' . $i . '</a></li>';
        }

        if ($this->hasMore()) {
            $nextPage = $this->nextPage();
            $html .= '<li><a href="' . $baseUrl . '?page=' . $nextPage . '">Next</a></li>';
        }

        $html .= '</ul>';
        $html .= '</nav>';

        return $html;
    }
}

// ============================================
// File: src\Routing\Route.php
// ============================================

namespace Framework\Routing;

/**
 * Route definition
 */
class Route
{
    /**
     * HTTP methods
     *
     * @var array
     */
    protected array $methods;

    /**
     * Route path
     *
     * @var string
     */
    protected string $path;

    /**
     * Route action
     *
     * @var callable|string|array
     */
    protected $action;

    /**
     * Route name
     *
     * @var string|null
     */
    protected ?string $name = null;

    /**
     * Middleware
     *
     * @var array
     */
    protected array $middleware = [];

    /**
     * Route parameters from URI
     *
     * @var array
     */
    protected array $parameters = [];

    /**
     * Create a new route
     *
     * @param array $methods
     * @param string $path
     * @param callable|string|array $action
     */
    public function __construct(array $methods, string $path, $action)
    {
        $this->methods = array_map('strtoupper', $methods);
        $this->path = $path;
        $this->action = $action;
    }

    /**
     * Set the route name
     *
     * @param string $name
     * @return self
     */
    public function name(string $name): self
    {
        $this->name = $name;
        return $this;
    }

    /**
     * Get the route name
     *
     * @return string|null
     */
    public function getName(): ?string
    {
        return $this->name;
    }

    /**
     * Add middleware to route
     *
     * @param string|array $middleware
     * @return self
     */
    public function middleware($middleware): self
    {
        $middlewares = is_array($middleware) ? $middleware : [$middleware];
        $this->middleware = array_merge($this->middleware, $middlewares);
        return $this;
    }

    /**
     * Get middleware
     *
     * @return array
     */
    public function getMiddleware(): array
    {
        return $this->middleware;
    }

    /**
     * Get the action
     *
     * @return callable|string|array
     */
    public function getAction()
    {
        return $this->action;
    }

    /**
     * Get HTTP methods
     *
     * @return array
     */
    public function getMethods(): array
    {
        return $this->methods;
    }

    /**
     * Get the path
     *
     * @return string
     */
    public function getPath(): string
    {
        return $this->path;
    }

    /**
     * Check if route matches URI and method
     *
     * @param string $uri
     * @param string $method
     * @return bool
     */
    public function matches(string $uri, string $method): bool
    {
        if (!in_array($method, $this->methods)) {
            return false;
        }

        $pattern = $this->compilePattern($this->path);
        return (bool)preg_match($pattern, $uri, $matches);
    }

    /**
     * Get parameters from URI
     *
     * @param string $uri
     * @return array
     */
    public function getParameters(string $uri): array
    {
        $pattern = $this->compilePattern($this->path);
        
        if (!preg_match($pattern, $uri, $matches)) {
            return [];
        }

        // Remove full match
        array_shift($matches);

        // Extract parameter names from path
        $paramNames = [];
        if (preg_match_all('/\{([a-z_]+)\}/', $this->path, $paramMatches)) {
            $paramNames = $paramMatches[1];
        }

        // Combine parameter names with values
        $parameters = [];
        foreach ($paramNames as $index => $name) {
            $parameters[$name] = $matches[$index] ?? null;
        }

        return $parameters;
    }

    /**
     * Compile route path to regex pattern
     *
     * @param string $path
     * @return string
     */
    protected function compilePattern(string $path): string
    {
        // Escape special regex characters except braces
        $escaped = preg_replace('/[.+?^${}()|[\]\\\\]/', '\\$0', $path);

        // Replace {param} with regex capture group
        $pattern = preg_replace('/\{([a-z_]+)\}/', '([a-z0-9_-]+)', $escaped);

        return '#^' . $pattern . '$#i';
    }
}

// ============================================
// File: src\Routing\Router.php
// ============================================

namespace Framework\Routing;

use Framework\Http\Request;
use Framework\Http\Response;

/**
 * Router for handling HTTP requests and routing
 */
class Router
{
    /**
     * All registered routes
     *
     * @var array
     */
    protected array $routes = [];

    /**
     * Named routes
     *
     * @var array
     */
    protected array $namedRoutes = [];

    /**
     * Current route group prefix
     *
     * @var string
     */
    protected string $groupPrefix = '';

    /**
     * Current route group middleware
     *
     * @var array
     */
    protected array $groupMiddleware = [];

    /**
     * Register a GET route
     *
     * @param string $path
     * @param callable|string|array $action
     * @return Route
     */
    public function get(string $path, $action): Route
    {
        return $this->addRoute(['GET', 'HEAD'], $path, $action);
    }

    /**
     * Register a POST route
     *
     * @param string $path
     * @param callable|string|array $action
     * @return Route
     */
    public function post(string $path, $action): Route
    {
        return $this->addRoute(['POST'], $path, $action);
    }

    /**
     * Register a PUT route
     *
     * @param string $path
     * @param callable|string|array $action
     * @return Route
     */
    public function put(string $path, $action): Route
    {
        return $this->addRoute(['PUT'], $path, $action);
    }

    /**
     * Register a PATCH route
     *
     * @param string $path
     * @param callable|string|array $action
     * @return Route
     */
    public function patch(string $path, $action): Route
    {
        return $this->addRoute(['PATCH'], $path, $action);
    }

    /**
     * Register a DELETE route
     *
     * @param string $path
     * @param callable|string|array $action
     * @return Route
     */
    public function delete(string $path, $action): Route
    {
        return $this->addRoute(['DELETE'], $path, $action);
    }

    /**
     * Register a route for all HTTP methods
     *
     * @param string $path
     * @param callable|string|array $action
     * @return Route
     */
    public function any(string $path, $action): Route
    {
        return $this->addRoute(['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS'], $path, $action);
    }

    /**
     * Register a resource route
     *
     * @param string $name
     * @param string $controller
     * @return void
     */
    public function resource(string $name, string $controller): void
    {
        $this->get($name, [$controller, 'index'])->name("{$name}.index");
        $this->get("{$name}/create", [$controller, 'create'])->name("{$name}.create");
        $this->post($name, [$controller, 'store'])->name("{$name}.store");
        $this->get("{$name}/{id}", [$controller, 'show'])->name("{$name}.show");
        $this->get("{$name}/{id}/edit", [$controller, 'edit'])->name("{$name}.edit");
        $this->put("{$name}/{id}", [$controller, 'update'])->name("{$name}.update");
        $this->delete("{$name}/{id}", [$controller, 'destroy'])->name("{$name}.destroy");
    }

    /**
     * Create a route group
     *
     * @param array $attributes
     * @param callable $callback
     * @return void
     */
    public function group(array $attributes, callable $callback): void
    {
        $previousPrefix = $this->groupPrefix;
        $previousMiddleware = $this->groupMiddleware;

        $this->groupPrefix = $previousPrefix . ($attributes['prefix'] ?? '');
        $this->groupMiddleware = array_merge($previousMiddleware, $attributes['middleware'] ?? []);

        call_user_func($callback, $this);

        $this->groupPrefix = $previousPrefix;
        $this->groupMiddleware = $previousMiddleware;
    }

    /**
     * Add a route
     *
     * @param array $methods
     * @param string $path
     * @param callable|string|array $action
     * @return Route
     */
    protected function addRoute(array $methods, string $path, $action): Route
    {
        $path = $this->groupPrefix . $path;
        $route = new Route($methods, $path, $action);

        if (!empty($this->groupMiddleware)) {
            $route->middleware($this->groupMiddleware);
        }

        $this->routes[] = $route;
        return $route;
    }

    /**
     * Match a request to a route
     *
     * @param Request $request
     * @return Route|null
     */
    public function match(Request $request): ?Route
    {
        $path = $request->path();
        $method = $request->method();

        foreach ($this->routes as $route) {
            if ($route->matches($path, $method)) {
                return $route;
            }
        }

        return null;
    }

    /**
     * Get the URL for a named route
     *
     * @param string $name
     * @param array $parameters
     * @return string
     */
    public function url(string $name, array $parameters = []): string
    {
        foreach ($this->routes as $route) {
            if ($route->getName() === $name) {
                $path = $route->getPath();

                foreach ($parameters as $param => $value) {
                    $path = str_replace('{' . $param . '}', $value, $path);
                }

                return '/' . ltrim($path, '/');
            }
        }

        return '/';
    }

    /**
     * Get all routes
     *
     * @return array
     */
    public function getRoutes(): array
    {
        return $this->routes;
    }
}

// ============================================
// File: src\Routing\UrlGenerator.php
// ============================================

namespace Framework\Routing;

class UrlGenerator {
    protected $router;
    protected $baseUrl;

    public function __construct(Router $router, $baseUrl = null) {
        $this->router = $router;
        $this->baseUrl = $baseUrl ?? config('app.url', 'http://localhost:8000');
    }

    public function to($path) {
        return $this->baseUrl . $path;
    }

    public function route($name, $parameters = []) {
        $url = $this->router->url($name, $parameters);

        if (!$url) {
            throw new \Exception("Route [$name] not found");
        }

        return $this->to($url);
    }

    public function current() {
        return $_SERVER['REQUEST_URI'] ?? '/';
    }

    public function previous($fallback = null) {
        return $_SERVER['HTTP_REFERER'] ?? $fallback;
    }

    public function full() {
        return $this->baseUrl . $this->current();
    }

    public function asset($path) {
        return $this->baseUrl . '/dist/' . $path;
    }
}

// ============================================
// File: src\Security\Csrf.php
// ============================================

namespace Framework\Security;

/**
 * CSRF token management
 */
class Csrf
{
    /**
     * Token session key
     *
     * @var string
     */
    protected string $tokenKey = '_token';

    /**
     * Get or create a CSRF token
     *
     * @return string
     */
    public function getToken(): string
    {
        $session = session();

        if (!$session->has($this->tokenKey)) {
            $session->put($this->tokenKey, bin2hex(random_bytes(32)));
        }

        return $session->get($this->tokenKey);
    }

    /**
     * Verify a CSRF token
     *
     * @param string $token
     * @return bool
     */
    public function verify(string $token): bool
    {
        return hash_equals($this->getToken(), $token);
    }

    /**
     * Regenerate token
     *
     * @return string
     */
    public function regenerate(): string
    {
        session()->forget($this->tokenKey);
        return $this->getToken();
    }
}

// ============================================
// File: src\Security\Hash.php
// ============================================

namespace Framework\Security;

/**
 * Password hashing using bcrypt
 */
class Hash
{
    /**
     * Hash a password
     *
     * @param string $password
     * @return string
     */
    public static function make(string $password): string
    {
        return password_hash($password, PASSWORD_BCRYPT);
    }

    /**
     * Verify a password
     *
     * @param string $password
     * @param string $hash
     * @return bool
     */
    public static function check(string $password, string $hash): bool
    {
        return password_verify($password, $hash);
    }

    /**
     * Check if a hash needs to be rehashed
     *
     * @param string $hash
     * @return bool
     */
    public static function needsRehash(string $hash): bool
    {
        return password_needs_rehash($hash, PASSWORD_BCRYPT);
    }
}

// ============================================
// File: src\Security\Validator.php
// ============================================

namespace Framework\Security;

class Validator {
    protected $data;
    protected $rules;
    protected $errors = [];

    public function __construct($data, $rules) {
        $this->data = $data;
        $this->rules = $rules;
    }

    public function validate() {
        foreach ($this->rules as $field => $rulesString) {
            $rules = explode('|', $rulesString);

            foreach ($rules as $rule) {
                $this->validateRule($field, $rule, $this->data[$field] ?? null);
            }
        }

        return empty($this->errors);
    }

    protected function validateRule($field, $rule, $value) {
        $parts = explode(':', $rule);
        $rule = $parts[0];
        $params = $parts[1] ?? null;

        switch ($rule) {
            case 'required':
                if (empty($value)) {
                    $this->addError($field, "$field is required");
                }
                break;
            case 'email':
                if ($value && !filter_var($value, FILTER_VALIDATE_EMAIL)) {
                    $this->addError($field, "$field must be a valid email");
                }
                break;
            case 'min':
                if ($value && strlen($value) < $params) {
                    $this->addError($field, "$field must be at least $params characters");
                }
                break;
            case 'max':
                if ($value && strlen($value) > $params) {
                    $this->addError($field, "$field must not exceed $params characters");
                }
                break;
            case 'numeric':
                if ($value && !is_numeric($value)) {
                    $this->addError($field, "$field must be numeric");
                }
                break;
            case 'url':
                if ($value && !filter_var($value, FILTER_VALIDATE_URL)) {
                    $this->addError($field, "$field must be a valid URL");
                }
                break;
            case 'confirmed':
                $confirmationField = $field . '_confirmation';
                if ($value !== ($this->data[$confirmationField] ?? null)) {
                    $this->addError($field, "$field confirmation does not match");
                }
                break;
            case 'unique':
                // Implementation would check database
                break;
            case 'regex':
                if ($value && !preg_match($params, $value)) {
                    $this->addError($field, "$field format is invalid");
                }
                break;
        }
    }

    protected function addError($field, $message) {
        if (!isset($this->errors[$field])) {
            $this->errors[$field] = [];
        }
        $this->errors[$field][] = $message;
    }

    public function errors() {
        return $this->errors;
    }

    public function hasErrors() {
        return !empty($this->errors);
    }
}

// ============================================
// File: src\Session\Manager.php
// ============================================

namespace Framework\Session;

/**
 * Session manager
 */
class Manager
{
    /**
     * Session started flag
     *
     * @var bool
     */
    protected bool $started = false;

    /**
     * Session data
     *
     * @var array
     */
    protected array $data = [];

    /**
     * Create a new session manager
     */
    public function __construct()
    {
        $this->start();
    }

    /**
     * Start the session
     *
     * @return void
     */
    public function start(): void
    {
        if (!$this->started) {
            if (session_status() === PHP_SESSION_NONE) {
                session_start();
            }
            $this->data = $_SESSION;
            $this->started = true;
        }
    }

    /**
     * Get a session value
     *
     * @param string $key
     * @param mixed $default
     * @return mixed
     */
    public function get(string $key, $default = null)
    {
        $keys = explode('.', $key);
        $value = $_SESSION;

        foreach ($keys as $segment) {
            if (is_array($value) && array_key_exists($segment, $value)) {
                $value = $value[$segment];
            } else {
                return $default;
            }
        }

        return $value;
    }

    /**
     * Put a value in the session
     *
     * @param string $key
     * @param mixed $value
     * @return void
     */
    public function put(string $key, $value): void
    {
        $keys = explode('.', $key);
        $current = &$_SESSION;

        foreach ($keys as $i => $segment) {
            if ($i === count($keys) - 1) {
                $current[$segment] = $value;
            } else {
                if (!isset($current[$segment])) {
                    $current[$segment] = [];
                }
                $current = &$current[$segment];
            }
        }

        $this->data = $_SESSION;
    }

    /**
     * Push a value onto a session array
     *
     * @param string $key
     * @param mixed $value
     * @return void
     */
    public function push(string $key, $value): void
    {
        $current = $this->get($key, []);

        if (!is_array($current)) {
            $current = [];
        }

        $current[] = $value;
        $this->put($key, $current);
    }

    /**
     * Remove a value from the session
     *
     * @param string $key
     * @return mixed
     */
    public function forget(string $key)
    {
        $keys = explode('.', $key);
        $value = null;
        $current = &$_SESSION;

        foreach ($keys as $i => $segment) {
            if ($i === count($keys) - 1) {
                $value = $current[$segment] ?? null;
                unset($current[$segment]);
            } else {
                if (isset($current[$segment])) {
                    $current = &$current[$segment];
                } else {
                    break;
                }
            }
        }

        $this->data = $_SESSION;
        return $value;
    }

    /**
     * Flush all session data
     *
     * @return void
     */
    public function flush(): void
    {
        $_SESSION = [];
        $this->data = [];
    }

    /**
     * Check if a session key exists
     *
     * @param string $key
     * @return bool
     */
    public function has(string $key): bool
    {
        return $this->get($key) !== null;
    }

    /**
     * Get all session data
     *
     * @return array
     */
    public function all(): array
    {
        return $_SESSION;
    }
}

// ============================================
// File: src\Support\Collection.php
// ============================================

namespace Framework\Support;

use ArrayIterator;
use Countable;
use IteratorAggregate;
use JsonSerializable;

/**
 * Collection class for working with arrays
 */
class Collection implements Countable, IteratorAggregate, JsonSerializable
{
    /**
     * Items in the collection
     *
     * @var array
     */
    protected array $items;

    /**
     * Create a new collection
     *
     * @param array $items
     */
    public function __construct(array $items = [])
    {
        $this->items = array_values($items);
    }

    /**
     * Get an item by key
     *
     * @param int|string $key
     * @param mixed $default
     * @return mixed
     */
    public function get($key, $default = null)
    {
        return $this->items[$key] ?? $default;
    }

    /**
     * Add an item to the collection
     *
     * @param mixed $item
     * @return self
     */
    public function add($item): self
    {
        $this->items[] = $item;
        return $this;
    }

    /**
     * Remove an item by key
     *
     * @param int|string $key
     * @return mixed
     */
    public function forget($key)
    {
        $item = $this->items[$key] ?? null;
        unset($this->items[$key]);
        return $item;
    }

    /**
     * Filter items
     *
     * @param callable $callback
     * @return self
     */
    public function filter(callable $callback): self
    {
        $items = array_filter($this->items, $callback, ARRAY_FILTER_USE_BOTH);
        return new static($items);
    }

    /**
     * Map over items
     *
     * @param callable $callback
     * @return self
     */
    public function map(callable $callback): self
    {
        $items = array_map($callback, $this->items);
        return new static($items);
    }

    /**
     * Reduce items
     *
     * @param callable $callback
     * @param mixed $initial
     * @return mixed
     */
    public function reduce(callable $callback, $initial = null)
    {
        return array_reduce($this->items, $callback, $initial);
    }

    /**
     * Get all items
     *
     * @return array
     */
    public function all(): array
    {
        return $this->items;
    }

    /**
     * Count items
     *
     * @return int
     */
    public function count(): int
    {
        return count($this->items);
    }

    /**
     * Get iterator
     *
     * @return ArrayIterator
     */
    public function getIterator(): ArrayIterator
    {
        return new ArrayIterator($this->items);
    }

    /**
     * Convert to JSON
     *
     * @return array
     */
    public function jsonSerialize(): array
    {
        return $this->items;
    }

    /**
     * Convert to array
     *
     * @return array
     */
    public function toArray(): array
    {
        return $this->items;
    }

    /**
     * Check if empty
     *
     * @return bool
     */
    public function isEmpty(): bool
    {
        return count($this->items) === 0;
    }

    /**
     * Get first item
     *
     * @return mixed
     */
    public function first()
    {
        return $this->items[0] ?? null;
    }

    /**
     * Get last item
     *
     * @return mixed
     */
    public function last()
    {
        return end($this->items) ?: null;
    }

    /**
     * Pluck values from items
     *
     * @param string $key
     * @return self
     */
    public function pluck(string $key): self
    {
        $items = array_map(function ($item) use ($key) {
            return is_array($item) ? $item[$key] ?? null : $item->$key ?? null;
        }, $this->items);
        return new static($items);
    }

    /**
     * Group items
     *
     * @param callable $callback
     * @return array
     */
    public function groupBy(callable $callback): array
    {
        $groups = [];
        foreach ($this->items as $item) {
            $key = $callback($item);
            $groups[$key][] = $item;
        }
        return $groups;
    }
}

// ============================================
// File: src\Support\helpers.php
// ============================================

use Framework\Container\Container;
use Framework\Config\Config;

if (!function_exists('app')) {
    /**
     * Get the application container instance or resolve a service
     *
     * @param string|null $abstract
     * @return Container|mixed
     */
    function app(?string $abstract = null)
    {
        global $__app;

        if ($abstract === null) {
            return $__app;
        }

        return $__app->make($abstract);
    }
}

if (!function_exists('config')) {
    /**
     * Get a configuration value
     *
     * @param string $key
     * @param mixed $default
     * @return mixed
     */
    function config(string $key, $default = null)
    {
        return app(Config::class)->get($key, $default);
    }
}

if (!function_exists('env')) {
    /**
     * Get an environment variable
     *
     * @param string $key
     * @param mixed $default
     * @return mixed
     */
    function env(string $key, $default = null)
    {
        return $_ENV[$key] ?? getenv($key) ?: $default;
    }
}

if (!function_exists('db')) {
    /**
     * Get the database manager
     *
     * @return \Framework\Database\Manager
     */
    function db()
    {
        return app(\Framework\Database\Manager::class);
    }
}

if (!function_exists('view')) {
    /**
     * Create a new view instance
     *
     * @param string $name
     * @param array $data
     * @return \Framework\View\View
     */
    function view(string $name, array $data = [])
    {
        return app(\Framework\View\View::class)->create($name, $data);
    }
}

if (!function_exists('response')) {
    /**
     * Create a new response instance
     *
     * @param mixed $content
     * @param int $status
     * @param array $headers
     * @return \Framework\Http\Response
     */
    function response($content = '', int $status = 200, array $headers = [])
    {
        return new \Framework\Http\Response($content, $status, $headers);
    }
}

if (!function_exists('json_response')) {
    /**
     * Create a new JSON response
     *
     * @param mixed $data
     * @param int $status
     * @param array $headers
     * @return \Framework\Http\JsonResponse
     */
    function json_response($data = [], int $status = 200, array $headers = [])
    {
        return new \Framework\Http\JsonResponse($data, $status, $headers);
    }
}

if (!function_exists('redirect')) {
    /**
     * Create a redirect response
     *
     * @param string $url
     * @param int $status
     * @return \Framework\Http\Response
     */
    function redirect(string $url, int $status = 302)
    {
        $response = response('', $status, ['Location' => $url]);
        return $response;
    }
}

if (!function_exists('back')) {
    /**
     * Redirect back
     *
     * @return \Framework\Http\Response
     */
    function back()
    {
        $referer = $_SERVER['HTTP_REFERER'] ?? '/';
        return redirect($referer);
    }
}

if (!function_exists('route')) {
    /**
     * Get the URL for a named route
     *
     * @param string $name
     * @param array $parameters
     * @return string
     */
    function route(string $name, array $parameters = [])
    {
        return app(\Framework\Routing\Router::class)->url($name, $parameters);
    }
}

if (!function_exists('url')) {
    /**
     * Generate a URL
     *
     * @param string $path
     * @return string
     */
    function url(string $path = '')
    {
        $base = config('app.url', 'http://localhost:8000');
        return rtrim($base, '/') . '/' . ltrim($path, '/');
    }
}

if (!function_exists('asset')) {
    /**
     * Generate an asset URL
     *
     * @param string $path
     * @return string
     */
    function asset(string $path)
    {
        return url('public/' . ltrim($path, '/'));
    }
}

if (!function_exists('auth')) {
    /**
     * Get the auth manager
     *
     * @return \Framework\Auth\AuthManager
     */
    function auth()
    {
        return app(\Framework\Auth\AuthManager::class);
    }
}

if (!function_exists('request')) {
    /**
     * Get the current request
     *
     * @return \Framework\Http\Request
     */
    function request()
    {
        return app(\Framework\Http\Request::class);
    }
}

if (!function_exists('session')) {
    /**
     * Get the session manager
     *
     * @return \Framework\Session\Manager
     */
    function session()
    {
        return app(\Framework\Session\Manager::class);
    }
}

if (!function_exists('logger')) {
    /**
     * Get the logger
     *
     * @return \Framework\Logging\Logger
     */
    function logger()
    {
        return app(\Framework\Logging\Logger::class);
    }
}

if (!function_exists('abort')) {
    /**
     * Abort with an HTTP status code
     *
     * @param int $status
     * @param string $message
     * @return void
     */
    function abort(int $status, string $message = '')
    {
        throw new \Framework\Exception\HttpException($status, $message);
    }
}

if (!function_exists('abort_if')) {
    /**
     * Abort if a condition is true
     *
     * @param bool $condition
     * @param int $status
     * @param string $message
     * @return void
     */
    function abort_if(bool $condition, int $status, string $message = '')
    {
        if ($condition) {
            abort($status, $message);
        }
    }
}

if (!function_exists('dd')) {
    /**
     * Dump and die
     *
     * @param mixed ...$vars
     * @return void
     */
    function dd(...$vars)
    {
        echo '<pre>';
        var_dump(...$vars);
        echo '</pre>';
        exit;
    }
}

if (!function_exists('dump')) {
    /**
     * Dump a variable
     *
     * @param mixed ...$vars
     * @return void
     */
    function dump(...$vars)
    {
        echo '<pre>';
        var_dump(...$vars);
        echo '</pre>';
    }
}

if (!function_exists('hash_password')) {
    /**
     * Hash a password
     *
     * @param string $password
     * @return string
     */
    function hash_password(string $password): string
    {
        return password_hash($password, PASSWORD_BCRYPT);
    }
}

if (!function_exists('verify_password')) {
    /**
     * Verify a password
     *
     * @param string $password
     * @param string $hash
     * @return bool
     */
    function verify_password(string $password, string $hash): bool
    {
        return password_verify($password, $hash);
    }
}

if (!function_exists('csrf_token')) {
    /**
     * Get or create a CSRF token
     *
     * @return string
     */
    function csrf_token(): string
    {
        return app(\Framework\Security\Csrf::class)->getToken();
    }
}

if (!function_exists('csrf_field')) {
    /**
     * Generate a CSRF token form field
     *
     * @return string
     */
    function csrf_field(): string
    {
        return '<input type="hidden" name="_token" value="' . csrf_token() . '">';
    }
}

if (!function_exists('old')) {
    /**
     * Get an old input value
     *
     * @param string $key
     * @param mixed $default
     * @return mixed
     */
    function old(string $key, $default = null)
    {
        return session()->get('old_input.' . $key, $default);
    }
}

if (!function_exists('now')) {
    /**
     * Get the current timestamp
     *
     * @return int
     */
    function now(): int
    {
        return time();
    }
}

if (!function_exists('base_path')) {
    /**
     * Get the base path
     *
     * @param string $path
     * @return string
     */
    function base_path(string $path = ''): string
    {
        return defined('BASE_PATH') ? BASE_PATH . ($path ? '/' . $path : '') : $path;
    }
}

if (!function_exists('app_path')) {
    /**
     * Get the app path
     *
     * @param string $path
     * @return string
     */
    function app_path(string $path = ''): string
    {
        return base_path('app' . ($path ? '/' . $path : ''));
    }
}

if (!function_exists('storage_path')) {
    /**
     * Get the storage path
     *
     * @param string $path
     * @return string
     */
    function storage_path(string $path = ''): string
    {
        return base_path('storage' . ($path ? '/' . $path : ''));
    }
}

if (!function_exists('resources_path')) {
    /**
     * Get the resources path
     *
     * @param string $path
     * @return string
     */
    function resources_path(string $path = ''): string
    {
        return base_path('resources' . ($path ? '/' . $path : ''));
    }
}

if (!function_exists('database_path')) {
    /**
     * Get the database path
     *
     * @param string $path
     * @return string
     */
    function database_path(string $path = ''): string
    {
        return base_path('database' . ($path ? '/' . $path : ''));
    }
}

if (!function_exists('class_basename')) {
    /**
     * Get the class basename
     *
     * @param object|string $class
     * @return string
     */
    function class_basename($class): string
    {
        $class = is_object($class) ? get_class($class) : $class;
        return basename(str_replace('\\', '/', $class));
    }
}

if (!function_exists('str_slug')) {
    /**
     * Convert a string to a slug
     *
     * @param string $string
     * @param string $separator
     * @return string
     */
    function str_slug(string $string, string $separator = '-'): string
    {
        $string = mb_strtolower($string);
        $string = preg_replace('/[^a-z0-9]+/i', $separator, $string);
        return trim($string, $separator);
    }
}

if (!function_exists('str_contains')) {
    /**
     * Check if a string contains a substring (PHP 8.0 compatibility)
     *
     * @param string $haystack
     * @param string $needle
     * @return bool
     */
    function str_contains(string $haystack, string $needle): bool
    {
        return strpos($haystack, $needle) !== false;
    }
}

if (!function_exists('collect')) {
    /**
     * Create a collection from an array
     *
     * @param array $items
     * @return \Framework\Support\Collection
     */
    function collect(array $items = [])
    {
        return new \Framework\Support\Collection($items);
    }
}

// ============================================
// File: src\Support\ServiceProvider.php
// ============================================

namespace Framework\Support;

class ServiceProvider {
    protected $app;

    public function __construct($app) {
        $this->app = $app;
    }

    public function register() {
        // Register bindings
    }

    public function boot() {
        // Bootstrap services
    }

    protected function publishes($source, $destination) {
        // Copy assets/config files from source to destination
    }
}

// ============================================
// File: src\Validation\Rules.php
// ============================================

namespace Framework\Validation;

class Rules {
    public static function required($value) {
        return !empty($value);
    }

    public static function email($value) {
        return filter_var($value, FILTER_VALIDATE_EMAIL) !== false;
    }

    public static function url($value) {
        return filter_var($value, FILTER_VALIDATE_URL) !== false;
    }

    public static function ip($value) {
        return filter_var($value, FILTER_VALIDATE_IP) !== false;
    }

    public static function numeric($value) {
        return is_numeric($value);
    }

    public static function integer($value) {
        return filter_var($value, FILTER_VALIDATE_INT) !== false;
    }

    public static function boolean($value) {
        return filter_var($value, FILTER_VALIDATE_BOOLEAN, FILTER_NULL_ON_FAILURE) !== null;
    }

    public static function min($value, $min) {
        if (is_numeric($value)) {
            return $value >= $min;
        }

        return strlen($value) >= $min;
    }

    public static function max($value, $max) {
        if (is_numeric($value)) {
            return $value <= $max;
        }

        return strlen($value) <= $max;
    }

    public static function between($value, $min, $max) {
        if (is_numeric($value)) {
            return $value >= $min && $value <= $max;
        }

        $length = strlen($value);
        return $length >= $min && $length <= $max;
    }

    public static function regex($value, $pattern) {
        return preg_match($pattern, $value) === 1;
    }

    public static function in($value, $values) {
        return in_array($value, $values);
    }

    public static function notIn($value, $values) {
        return !in_array($value, $values);
    }

    public static function confirmed($value, $confirmed) {
        return $value === $confirmed;
    }

    public static function date($value) {
        return strtotime($value) !== false;
    }

    public static function before($value, $date) {
        return strtotime($value) < strtotime($date);
    }

    public static function after($value, $date) {
        return strtotime($value) > strtotime($date);
    }

    public static function json($value) {
        json_decode($value);
        return json_last_error() === JSON_ERROR_NONE;
    }

    public static function array($value) {
        return is_array($value);
    }

    public static function string($value) {
        return is_string($value);
    }
}

// ============================================
// File: src\Validation\Validator.php
// ============================================

namespace Framework\Validation;

/**
 * Input validation engine
 */
class Validator
{
    /**
     * Data to validate
     *
     * @var array
     */
    protected array $data;

    /**
     * Validation rules
     *
     * @var array
     */
    protected array $rules;

    /**
     * Validation errors
     *
     * @var array
     */
    protected array $errors = [];

    /**
     * Create a new validator
     *
     * @param array $data
     * @param array $rules
     */
    public function __construct(array $data, array $rules)
    {
        $this->data = $data;
        $this->rules = $rules;
        $this->validate();
    }

    /**
     * Run validation
     *
     * @return void
     */
    protected function validate(): void
    {
        foreach ($this->rules as $field => $ruleString) {
            $rules = explode('|', $ruleString);

            foreach ($rules as $rule) {
                $this->validateRule($field, $rule);
            }
        }
    }

    /**
     * Validate a single rule
     *
     * @param string $field
     * @param string $rule
     * @return void
     */
    protected function validateRule(string $field, string $rule): void
    {
        $value = $this->data[$field] ?? null;
        [$ruleName, $parameters] = $this->parseRule($rule);

        switch ($ruleName) {
            case 'required':
                if (empty($value)) {
                    $this->addError($field, "{$field} is required");
                }
                break;

            case 'email':
                if (!empty($value) && !filter_var($value, FILTER_VALIDATE_EMAIL)) {
                    $this->addError($field, "{$field} must be a valid email");
                }
                break;

            case 'min':
                $min = $parameters[0] ?? 0;
                if (!empty($value) && strlen((string)$value) < $min) {
                    $this->addError($field, "{$field} must be at least {$min} characters");
                }
                break;

            case 'max':
                $max = $parameters[0] ?? 255;
                if (!empty($value) && strlen((string)$value) > $max) {
                    $this->addError($field, "{$field} must not exceed {$max} characters");
                }
                break;

            case 'confirmed':
                $confirmed = $this->data["{$field}_confirmation"] ?? null;
                if ($value !== $confirmed) {
                    $this->addError($field, "{$field} confirmation does not match");
                }
                break;

            case 'numeric':
                if (!empty($value) && !is_numeric($value)) {
                    $this->addError($field, "{$field} must be numeric");
                }
                break;

            case 'string':
                if (!empty($value) && !is_string($value)) {
                    $this->addError($field, "{$field} must be a string");
                }
                break;

            case 'array':
                if (!empty($value) && !is_array($value)) {
                    $this->addError($field, "{$field} must be an array");
                }
                break;

            case 'unique':
                $this->validateUnique($field, $value, $parameters);
                break;

            case 'exists':
                $this->validateExists($field, $value, $parameters);
                break;

            case 'regex':
                $pattern = $parameters[0] ?? '';
                if (!empty($value) && !preg_match($pattern, $value)) {
                    $this->addError($field, "{$field} format is invalid");
                }
                break;
        }
    }

    /**
     * Parse a rule string
     *
     * @param string $rule
     * @return array
     */
    protected function parseRule(string $rule): array
    {
        if (strpos($rule, ':') !== false) {
            [$name, $params] = explode(':', $rule, 2);
            return [$name, explode(',', $params)];
        }

        return [$rule, []];
    }

    /**
     * Validate unique rule
     *
     * @param string $field
     * @param mixed $value
     * @param array $parameters
     * @return void
     */
    protected function validateUnique(string $field, $value, array $parameters): void
    {
        if (empty($value) || empty($parameters)) {
            return;
        }

        $table = $parameters[0] ?? '';
        $column = $parameters[1] ?? $field;

        $exists = db()->table($table)
            ->where($column, $value)
            ->count() > 0;

        if ($exists) {
            $this->addError($field, "{$field} already exists");
        }
    }

    /**
     * Validate exists rule
     *
     * @param string $field
     * @param mixed $value
     * @param array $parameters
     * @return void
     */
    protected function validateExists(string $field, $value, array $parameters): void
    {
        if (empty($value) || empty($parameters)) {
            return;
        }

        $table = $parameters[0] ?? '';
        $column = $parameters[1] ?? $field;

        $exists = db()->table($table)
            ->where($column, $value)
            ->count() > 0;

        if (!$exists) {
            $this->addError($field, "{$field} does not exist");
        }
    }

    /**
     * Add an error
     *
     * @param string $field
     * @param string $message
     * @return void
     */
    protected function addError(string $field, string $message): void
    {
        if (!isset($this->errors[$field])) {
            $this->errors[$field] = [];
        }

        $this->errors[$field][] = $message;
    }

    /**
     * Check if validation failed
     *
     * @return bool
     */
    public function fails(): bool
    {
        return !empty($this->errors);
    }

    /**
     * Check if validation passed
     *
     * @return bool
     */
    public function passes(): bool
    {
        return empty($this->errors);
    }

    /**
     * Get all errors
     *
     * @return array
     */
    public function errors(): array
    {
        return $this->errors;
    }

    /**
     * Get errors for a field
     *
     * @param string $field
     * @return array
     */
    public function getErrors(string $field): array
    {
        return $this->errors[$field] ?? [];
    }

    /**
     * Get validated data
     *
     * @return array
     */
    public function validated(): array
    {
        $validated = [];

        foreach (array_keys($this->rules) as $field) {
            if (isset($this->data[$field])) {
                $validated[$field] = $this->data[$field];
            }
        }

        return $validated;
    }
}

// ============================================
// File: src\View\BladeCompiler.php
// ============================================

namespace Framework\View;

/**
 * Blade template compiler
 * 
 * Compiles Blade syntax to PHP
 */
class BladeCompiler
{
    /**
     * Compile blade template
     *
     * @param string $content
     * @return string
     */
    public function compile(string $content): string
    {
        // Compile directives
        $content = $this->compileDirectives($content);
        $content = $this->compileEchos($content);
        $content = $this->compileLoops($content);
        $content = $this->compileConditionals($content);
        $content = $this->compileIncludes($content);

        return $content;
    }

    /**
     * Compile blade directives
     *
     * @param string $content
     * @return string
     */
    protected function compileDirectives(string $content): string
    {
        // @csrf
        $content = str_replace('@csrf', '<?php echo csrf_field(); ?>', $content);

        // @auth
        $content = preg_replace(
            '/@auth\s*/',
            '<?php if (auth()->check()): ?>',
            $content
        );

        // @endauth
        $content = str_replace('@endauth', '<?php endif; ?>', $content);

        // @guest
        $content = preg_replace(
            '/@guest\s*/',
            '<?php if (!auth()->check()): ?>',
            $content
        );

        // @endguest
        $content = str_replace('@endguest', '<?php endif; ?>', $content);

        return $content;
    }

    /**
     * Compile echo statements
     *
     * @param string $content
     * @return string
     */
    protected function compileEchos(string $content): string
    {
        // {{ $variable }}
        $content = preg_replace_callback(
            '/\{\{\s*(.+?)\s*\}\}/',
            function ($matches) {
                return '<?php echo htmlspecialchars(' . $matches[1] . ', ENT_QUOTES, "UTF-8"); ?>';
            },
            $content
        );

        // {!! $html !!}
        $content = preg_replace_callback(
            '/\{!!\s*(.+?)\s*!!\}/',
            function ($matches) {
                return '<?php echo ' . $matches[1] . '; ?>';
            },
            $content
        );

        return $content;
    }

    /**
     * Compile loops
     *
     * @param string $content
     * @return string
     */
    protected function compileLoops(string $content): string
    {
        // @foreach
        $content = preg_replace(
            '/@foreach\s*\(\s*\$(.+?)\s+as\s+\$(.+?)\s*\)/',
            '<?php foreach ($\1 as $\2): ?>',
            $content
        );

        // @endforeach
        $content = str_replace('@endforeach', '<?php endforeach; ?>', $content);

        // @for
        $content = preg_replace(
            '/@for\s*\(\s*(.+?)\s*\)/',
            '<?php for (\1): ?>',
            $content
        );

        // @endfor
        $content = str_replace('@endfor', '<?php endfor; ?>', $content);

        // @while
        $content = preg_replace(
            '/@while\s*\(\s*(.+?)\s*\)/',
            '<?php while (\1): ?>',
            $content
        );

        // @endwhile
        $content = str_replace('@endwhile', '<?php endwhile; ?>', $content);

        return $content;
    }

    /**
     * Compile conditionals
     *
     * @param string $content
     * @return string
     */
    protected function compileConditionals(string $content): string
    {
        // @if
        $content = preg_replace(
            '/@if\s*\(\s*(.+?)\s*\)/',
            '<?php if (\1): ?>',
            $content
        );

        // @elseif
        $content = preg_replace(
            '/@elseif\s*\(\s*(.+?)\s*\)/',
            '<?php elseif (\1): ?>',
            $content
        );

        // @else
        $content = str_replace('@else', '<?php else: ?>', $content);

        // @endif
        $content = str_replace('@endif', '<?php endif; ?>', $content);

        // @unless
        $content = preg_replace(
            '/@unless\s*\(\s*(.+?)\s*\)/',
            '<?php if (!\1): ?>',
            $content
        );

        // @endunless
        $content = str_replace('@endunless', '<?php endif; ?>', $content);

        return $content;
    }

    /**
     * Compile includes
     *
     * @param string $content
     * @return string
     */
    protected function compileIncludes(string $content): string
    {
        // @include('view.name')
        $content = preg_replace(
            '/@include\(\s*[\'"](.+?)[\'"]\s*\)/',
            '<?php echo view("\1", get_defined_vars())->render(); ?>',
            $content
        );

        // @include('view.name', ['data' => $value])
        $content = preg_replace(
            '/@include\(\s*[\'"](.+?)[\'"],\s*(\[.+?\])\s*\)/',
            '<?php echo view("\1", array_merge(get_defined_vars(), \2))->render(); ?>',
            $content
        );

        return $content;
    }
}

// ============================================
// File: src\View\Factory.php
// ============================================

namespace Framework\View;

class Factory {
    protected $config;
    protected $viewsPath;
    protected $shared = [];

    public function __construct($config) {
        $this->config = $config;
        $this->viewsPath = RESOURCES_PATH . '/views';
    }

    public function make($view, $data = []) {
        $path = $this->getPath($view);

        if (!file_exists($path)) {
            throw new \Exception("View not found: $view");
        }

        return new View($path, array_merge($this->shared, $data));
    }

    public function share($key, $value = null) {
        if (is_array($key)) {
            foreach ($key as $k => $v) {
                $this->shared[$k] = $v;
            }
        } else {
            $this->shared[$key] = $value;
        }
        return $this;
    }

    public function exists($view) {
        return file_exists($this->getPath($view));
    }

    protected function getPath($view) {
        $view = str_replace('.', '/', $view);
        return $this->viewsPath . '/' . $view . '.blade.php';
    }
}

// ============================================
// File: src\View\View.php
// ============================================

namespace Framework\View;

/**
 * View renderer
 */
class View
{
    /**
     * View paths
     *
     * @var array
     */
    protected array $paths = [];

    /**
     * View data
     *
     * @var array
     */
    protected array $data = [];

    /**
     * View name
     *
     * @var string|null
     */
    protected ?string $view = null;

    /**
     * Create a new view instance
     *
     * @param array $paths
     */
    public function __construct(array $paths = [])
    {
        $this->paths = $paths ?: [resources_path('views')];
    }

    /**
     * Create a view
     *
     * @param string $name
     * @param array $data
     * @return self
     */
    public function create(string $name, array $data = []): self
    {
        $this->view = $name;
        $this->data = $data;
        return $this;
    }

    /**
     * Share data across all views
     *
     * @param string $key
     * @param mixed $value
     * @return self
     */
    public function share(string $key, $value): self
    {
        $this->data[$key] = $value;
        return $this;
    }

    /**
     * Render the view
     *
     * @return string
     */
    public function render(): string
    {
        $path = $this->findView($this->view);

        if (!$path || !file_exists($path)) {
            throw new \RuntimeException("View [{$this->view}] not found");
        }

        // Compile blade if needed
        if (str_ends_with($path, '.blade.php')) {
            $compiled = $this->compileBlade($path);
        } else {
            $compiled = $path;
        }

        // Extract data
        extract($this->data);

        // Render
        ob_start();
        include $compiled;
        return ob_get_clean();
    }

    /**
     * Find view file
     *
     * @param string $name
     * @return string|null
     */
    protected function findView(string $name): ?string
    {
        $name = str_replace('.', '/', $name);

        foreach ($this->paths as $path) {
            $file = $path . '/' . $name . '.blade.php';
            if (file_exists($file)) {
                return $file;
            }

            $file = $path . '/' . $name . '.php';
            if (file_exists($file)) {
                return $file;
            }
        }

        return null;
    }

    /**
     * Compile blade template
     *
     * @param string $path
     * @return string
     */
    protected function compileBlade(string $path): string
    {
        $compiler = new BladeCompiler();
        $compiled = $compiler->compile(file_get_contents($path));

        $cachePath = storage_path('views');
        if (!is_dir($cachePath)) {
            mkdir($cachePath, 0755, true);
        }

        $cacheFile = $cachePath . '/' . md5($path) . '.php';
        file_put_contents($cacheFile, $compiled);

        return $cacheFile;
    }

    /**
     * Convert to string
     *
     * @return string
     */
    public function __toString(): string
    {
        return $this->render();
    }
}

// ============================================
// File: app\Controllers\Api\UserController.php
// ============================================

namespace App\Controllers\Api;

use App\Models\User;

class UserController {
    public function index() {
        $users = User::all();
        return json_response($users);
    }

    public function store() {
        $data = json_decode(file_get_contents('php://input'), true);

        $validator = new \Framework\Security\Validator($data, [
            'name' => 'required|min:3',
            'email' => 'required|email|unique:users',
            'password' => 'required|min:8|confirmed',
        ]);

        if ($validator->validate()) {
            $user = User::create([
                'name' => $data['name'],
                'email' => $data['email'],
                'password' => \Framework\Security\Hash::make($data['password']),
            ]);

            return json_response(['user' => $user], 201);
        }

        return json_response(['errors' => $validator->errors()], 422);
    }

    public function show($id) {
        $user = User::find($id);

        if (!$user) {
            return json_response(['error' => 'User not found'], 404);
        }

        return json_response(['user' => $user]);
    }

    public function update($id) {
        $user = User::find($id);

        if (!$user) {
            return json_response(['error' => 'User not found'], 404);
        }

        $data = json_decode(file_get_contents('php://input'), true);

        $validator = new \Framework\Security\Validator($data, [
            'name' => 'required|min:3',
            'email' => 'required|email',
        ]);

        if ($validator->validate()) {
            $user->update([
                'name' => $data['name'],
                'email' => $data['email'],
            ]);

            return json_response(['user' => $user]);
        }

        return json_response(['errors' => $validator->errors()], 422);
    }

    public function destroy($id) {
        $user = User::find($id);

        if (!$user) {
            return json_response(['error' => 'User not found'], 404);
        }

        $user->delete();

        return json_response(['message' => 'User deleted successfully']);
    }
}

// ============================================
// File: app\Controllers\AuthController.php
// ============================================

namespace App\Controllers;

use App\Models\User;
use Framework\Security\Hash;

class AuthController {
    public function login() {
        return view('auth.login');
    }

    public function postLogin() {
        $email = $_POST['email'] ?? null;
        $password = $_POST['password'] ?? null;

        if (auth()->attempt($email, $password)) {
            return redirect('/');
        }

        return redirect('/login')->with('error', 'Invalid credentials');
    }

    public function register() {
        return view('auth.register');
    }

    public function postRegister() {
        $data = $_POST;

        $validator = new \Framework\Security\Validator($data, [
            'name' => 'required|min:3',
            'email' => 'required|email',
            'password' => 'required|min:8|confirmed',
        ]);

        if (!$validator->validate()) {
            return redirect('/register')->with('errors', $validator->errors());
        }

        $user = User::create([
            'name' => $data['name'],
            'email' => $data['email'],
            'password' => Hash::make($data['password']),
        ]);

        auth()->login($user);

        return redirect('/');
    }

    public function logout() {
        auth()->logout();
        return redirect('/');
    }
}

// ============================================
// File: app\Controllers\Controller.php
// ============================================

namespace App\Controllers;

class Controller {
    protected $request;
    protected $response;

    public function __construct() {
        $this->request = app('request') ?? request();
    }

    protected function view($view, $data = []) {
        return app('view')->make($view, $data);
    }

    protected function json($data, $status = 200) {
        return json_response($data, $status);
    }

    protected function redirect($url, $status = 302) {
        $response = new \Framework\Http\Response('', $status);
        return $response->redirect($url, $status);
    }

    protected function validate($data, $rules) {
        $validator = new \Framework\Security\Validator($data, $rules);

        if (!$validator->validate()) {
            throw new \Framework\Exceptions\ValidationException($validator->errors());
        }

        return true;
    }

    protected function authorize($ability, $model = null) {
        if (!auth()->check()) {
            abort(403, 'Unauthorized');
        }

        return true;
    }

    protected function abort($code, $message = null) {
        abort($code, $message);
    }
}

// ============================================
// File: app\Controllers\HomeController.php
// ============================================

namespace App\Controllers;

use Framework\Foundation\Controller;
use Framework\Http\Response;

/**
 * Home Controller
 * 
 * Handles home page requests
 */
class HomeController extends Controller
{
    /**
     * Display the home page
     *
     * @return Response
     */
    public function index(): Response
    {
        $appName = config('app.name');
        $html = <<<HTML
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to {$appName}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            text-align: center;
            background: white;
            padding: 60px 40px;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 2.5em;
        }
        p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        .features {
            margin: 30px 0;
            text-align: left;
        }
        .features h2 {
            color: #333;
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
        }
        .feature-list {
            list-style: none;
        }
        .feature-list li {
            color: #555;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:before {
            content: " ";
            color: #667eea;
            font-weight: bold;
            margin-right: 10px;
        }
        .cta {
            margin-top: 30px;
        }
        .cta a {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: transform 0.3s;
            margin: 5px;
        }
        .cta a:hover {
            transform: translateY(-2px);
        }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1> Welcome to {$appName}</h1>
        
        <p>A production-grade PHP framework inspired by Laravel, built from scratch.</p>
        
        <div class="features">
            <h2>Features</h2>
            <ul class="feature-list">
                <li>Service Container & Dependency Injection</li>
                <li>Full-featured Router with Named Routes</li>
                <li>Eloquent-like Active Record ORM</li>
                <li>Blade Template Engine</li>
                <li>Database Query Builder</li>
                <li>Input Validation</li>
                <li>Session Management</li>
                <li>Authentication System</li>
                <li>CSRF Protection</li>
                <li>Artisan CLI Commands</li>
                <li>Support for SQLite, MySQL, MariaDB, PostgreSQL</li>
                <li>Structured Logging</li>
            </ul>
        </div>
        
        <div class="cta">
            <a href="https://github.com/kessud2021/Quill" target="_blank"> View on GitHub</a>
        </div>
        
        <p style="margin-top: 30px; font-size: 0.9em; color: #999;">
            Start building with <code>php artisan make:controller YourController</code>
        </p>
    </div>
</body>
</html>
HTML;

        return response($html);
    }
}

// ============================================
// File: app\Middleware\AuthMiddleware.php
// ============================================

namespace App\Middleware;

use Framework\Middleware\Middleware;

class AuthMiddleware extends Middleware {
    public function handle($request, $next) {
        if (!auth()->check()) {
            return redirect('/login');
        }

        return $next($request);
    }
}

// ============================================
// File: app\Middleware\CorsMiddleware.php
// ============================================

namespace App\Middleware;

use Framework\Middleware\Middleware;

class CorsMiddleware extends Middleware {
    public function handle($request, $next) {
        header('Access-Control-Allow-Origin: *');
        header('Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS');
        header('Access-Control-Allow-Headers: Content-Type, Authorization');

        if ($request->getMethod() === 'OPTIONS') {
            return new \Framework\Http\Response('', 200);
        }

        return $next($request);
    }
}

// ============================================
// File: app\Middleware\TrimStringsMiddleware.php
// ============================================

namespace App\Middleware;

use Framework\Middleware\Middleware;

class TrimStringsMiddleware extends Middleware {
    protected $skip = ['password', 'password_confirmation'];

    public function handle($request, $next) {
        $data = [];

        foreach ($request->all() as $key => $value) {
            if (in_array($key, $this->skip)) {
                $data[$key] = $value;
            } else {
                $data[$key] = is_string($value) ? trim($value) : $value;
            }
        }

        return $next($request);
    }
}

// ============================================
// File: app\Models\Post.php
// ============================================

namespace App\Models;

use Framework\Database\Model;

class Post extends Model {
    protected $table = 'posts';
    protected $fillable = ['title', 'content', 'user_id', 'published_at'];
    protected $timestamps = true;
    protected $softDelete = true;

    public function user() {
        return $this->belongsTo(User::class);
    }

    public function isPublished() {
        return $this->getAttribute('published_at') !== null;
    }
}

// ============================================
// File: app\Models\User.php
// ============================================

namespace App\Models;

use Framework\Database\Model;

/**
 * User Model
 * 
 * Represents a user in the application
 */
class User extends Model
{
    /**
     * Table name
     *
     * @var string|null
     */
    protected ?string $table = 'users';

    /**
     * Primary key
     *
     * @var string
     */
    protected string $primaryKey = 'id';

    /**
     * Fillable attributes
     *
     * @var array
     */
    protected array $fillable = [
        'name',
        'email',
        'password',
    ];

    /**
     * Soft delete column
     *
     * @var string|null
     */
    protected ?string $softDeleteColumn = 'deleted_at';

    /**
     * Hash password on set
     *
     * @param string $password
     * @return void
     */
    public function setPasswordAttribute(string $password): void
    {
        $this->attributes['password'] = password_hash($password, PASSWORD_BCRYPT);
    }

    /**
     * Check if password matches
     *
     * @param string $password
     * @return bool
     */
    public function checkPassword(string $password): bool
    {
        return password_verify($password, $this->password);
    }
}

// ============================================
// File: app\Providers\AppServiceProvider.php
// ============================================

namespace App\Providers;

use Framework\Support\ServiceProvider;

class AppServiceProvider extends ServiceProvider {
    public function register() {
        $this->registerCsrf();
        $this->registerValidation();
    }

    public function boot() {
        // Application boot logic
    }

    protected function registerCsrf() {
        $this->app->singleton('csrf', function () {
            return new \Framework\Security\Csrf();
        });
    }

    protected function registerValidation() {
        $this->app->bind('validator', function ($app, $data, $rules) {
            return new \Framework\Security\Validator($data, $rules);
        });
    }
}

// ============================================
// File: app\Providers\DatabaseServiceProvider.php
// ============================================

namespace App\Providers;

use Framework\Support\ServiceProvider;

class DatabaseServiceProvider extends ServiceProvider {
    public function register() {
        // Database already registered in Application::registerCoreServices
    }

    public function boot() {
        // Run any database boot logic
    }
}

// ============================================
// File: database\migrations\2024_01_01_000000_create_users_table.php
// ============================================

namespace Database\Migrations;

use Framework\Database\Migrations\Migration;

class CreateUsersTable extends Migration {
    public function up() {
        $this->schema()->create('users', function ($table) {
            $table->increments('id');
            $table->string('name');
            $table->string('email')->unique();
            $table->string('password');
            $table->timestamp('email_verified_at')->nullable();
            $table->string('remember_token')->nullable();
            $table->timestamps();
            $table->softDeletes();
        });
    }

    public function down() {
        $this->schema()->drop('users');
    }
}

// ============================================
// File: database\migrations\2024_01_02_000000_create_posts_table.php
// ============================================

namespace Database\Migrations;

use Framework\Database\Migrations\Migration;

class CreatePostsTable extends Migration {
    public function up() {
        $this->schema()->create('posts', function ($table) {
            $table->increments('id');
            $table->string('title');
            $table->text('content');
            $table->integer('user_id');
            $table->timestamp('published_at')->nullable();
            $table->timestamps();
            $table->softDeletes();
            
            $table->foreign('user_id')
                  ->references('id')
                  ->on('users');
        });
    }

    public function down() {
        $this->schema()->drop('posts');
    }
}

// ============================================
// File: database\seeds\DatabaseSeeder.php
// ============================================

namespace Database\Seeds;

class DatabaseSeeder {
    public function run() {
        $this->seedUsers();
    }

    protected function seedUsers() {
        $users = [
            [
                'name' => 'John Doe',
                'email' => 'john@example.com',
                'password' => \Framework\Security\Hash::make('password123'),
            ],
            [
                'name' => 'Jane Smith',
                'email' => 'jane@example.com',
                'password' => \Framework\Security\Hash::make('password123'),
            ],
            [
                'name' => 'Bob Johnson',
                'email' => 'bob@example.com',
                'password' => \Framework\Security\Hash::make('password123'),
            ],
        ];

        foreach ($users as $user) {
            \App\Models\User::create($user);
        }
    }
}

// ============================================
// File: database\seeds\UserSeeder.php
// ============================================

namespace Database\Seeds;

class UserSeeder {
    public function run() {
        $users = [
            [
                'name' => 'John Doe',
                'email' => 'john@example.com',
                'password' => \Framework\Security\Hash::make('password123'),
            ],
            [
                'name' => 'Jane Smith',
                'email' => 'jane@example.com',
                'password' => \Framework\Security\Hash::make('password123'),
            ],
            [
                'name' => 'Bob Johnson',
                'email' => 'bob@example.com',
                'password' => \Framework\Security\Hash::make('password123'),
            ],
        ];

        foreach ($users as $user) {
            \App\Models\User::create($user);
        }
    }
}

// ============================================
// File: index.php
// ============================================



// ============================================
// File: resources\views\layout.blade.php
// ============================================

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ $title ?? 'Quill App' }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        .header h1 {
            font-size: 2em;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        .footer {
            background: white;
            border-top: 1px solid #ddd;
            padding: 2rem 0;
            margin-top: 4rem;
            text-align: center;
            color: #666;
        }
        main {
            background: white;
            padding: 2rem;
            border-radius: 5px;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>{{ $appName ?? 'Quill' }}</h1>
        </div>
    </div>

    <div class="container">
        <main>
            @yield('content')
        </main>
    </div>

    <div class="footer">
        <div class="container">
            <p>&copy; {{ date('Y') }} {{ $appName ?? 'Quill App' }}. All rights reserved.</p>
        </div>
    </div>
</body>
</html>

// ============================================
// File: resources\views\welcome.blade.php
// ============================================

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome - {{ $appName ?? 'Quill' }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
        }
        .navbar {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 1rem 0;
            margin-bottom: 2rem;
        }
        .navbar-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .navbar h1 {
            font-size: 1.5em;
            color: #667eea;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        h1, h2 {
            color: #333;
            margin: 2rem 0 1rem 0;
        }
        p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 1rem;
            border-radius: 5px;
            overflow-x: auto;
            margin: 1rem 0;
        }
        .code-block code {
            color: inherit;
            background: none;
            padding: 0;
        }
        a {
            color: #667eea;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="navbar-content">
            <h1>{{ $appName ?? 'Quill' }}</h1>
            @if (auth()->check())
                <div>
                    Welcome, {{ auth()->user()->name }}!
                </div>
            @endif
        </div>
    </div>

    <div class="container">
        <h1>Welcome to Quill Framework</h1>

        <p>This is a demonstration view using Blade template syntax.</p>

        <h2>What's Next?</h2>

        <ol>
            <li>Create your first controller: <code>php artisan make:controller PostController</code></li>
            <li>Generate a model: <code>php artisan make:model Post</code></li>
            <li>Create a migration: <code>php artisan make:migration create_posts_table</code></li>
            <li>Add routes in <code>routes/web.php</code></li>
            <li>Create views in <code>resources/views</code></li>
        </ol>

        <h2>Framework Structure</h2>

        <div class="code-block">
            <code>
app/
 Controllers/
 Models/
 Providers/

config/
 app.php
 database.php
 auth.php

database/
 migrations/
 seeders/

resources/
 views/

routes/
 web.php

src/
 Auth/
 Config/
 Console/
 Container/
 Database/
 Env/
 Exception/
 Foundation/
 Http/
 Logging/
 Middleware/
 Routing/
 Security/
 Session/
 Support/
 Validation/
 View/
            </code>
        </div>

        <h2>Learn More</h2>

        <p>
            Check out the <a href="https://github.com/kessud2021/Quill" target="_blank">GitHub repository</a>
            for documentation and examples.
        </p>
    </div>
</body>
</html>

// ============================================
// File: routes\web.php
// ============================================

/**
 * Web Routes
 * 
 * All web routes are registered here
 */

$router = app(\Framework\Routing\Router::class);

// Home route
$router->get('/', 'App\\Controllers\\HomeController@index')->name('home');

// Example resource route
// $router->resource('posts', 'App\\Controllers\\PostController');

// Example route group
// $router->group(['prefix' => 'api', 'middleware' => ['api']], function ($router) {
//     $router->get('/users', 'App\\Controllers\\Api\\UserController@index');
//     $router->post('/users', 'App\\Controllers\\Api\\UserController@store');
// });

// Example protected route
// $router->get('/dashboard', 'App\\Controllers\\DashboardController@index')
//     ->name('dashboard')
//     ->middleware('auth');

// ============================================
// Bundled files (93 total)
// ============================================
// bootstrap\app.php
// config\app.php
// config\auth.php
// config\cache.php
// config\database.php
// config\logging.php
// config\session.php
// src\Auth\AuthManager.php
// src\Auth\Guard.php
// src\Cache\Store.php
// src\Config\Config.php
// src\Config\Repository.php
// src\Console\Application.php
// src\Console\Command.php
// src\Console\Commands\Command.php
// src\Console\Commands\MakeControllerCommand.php
// src\Console\Commands\MakeMigrationCommand.php
// src\Console\Commands\MakeModelCommand.php
// src\Console\Commands\MakeProviderCommand.php
// src\Console\Commands\MakeRequestCommand.php
// src\Console\Commands\MigrateCommand.php
// src\Console\Commands\MigrateRollbackCommand.php
// src\Console\Commands\RollbackCommand.php
// src\Console\Commands\SeedCommand.php
// src\Console\Commands\ServeCommand.php
// src\Console\Commands\TinkerCommand.php
// src\Container\Container.php
// src\Database\Connection.php
// src\Database\Factory.php
// src\Database\Manager.php
// src\Database\Migrations\Migration.php
// src\Database\Migrations\MigrationRunner.php
// src\Database\Model.php
// src\Database\QueryBuilder.php
// src\Database\Schema\Blueprint.php
// src\Database\Schema\Builder.php
// src\Database\Schema\ColumnDefinition.php
// src\Database\Schema\ForeignKeyDefinition.php
// src\Database\SqlLoader.php
// src\Env\DotEnv.php
// src\Env\Loader.php
// src\Events\Dispatcher.php
// src\Exception\HttpException.php
// src\Exceptions\Handler.php
// src\Exceptions\HttpException.php
// src\Exceptions\ValidationException.php
// src\Filesystem\File.php
// src\Foundation\Application.php
// src\Foundation\Controller.php
// src\Http\JsonResponse.php
// src\Http\Request.php
// src\Http\Response.php
// src\Logging\Logger.php
// src\Middleware\Middleware.php
// src\Middleware\Stack.php
// src\Notifications\Channels\DatabaseChannel.php
// src\Notifications\Channels\MailChannel.php
// src\Notifications\Notification.php
// src\Pagination\Paginator.php
// src\Routing\Route.php
// src\Routing\Router.php
// src\Routing\UrlGenerator.php
// src\Security\Csrf.php
// src\Security\Hash.php
// src\Security\Validator.php
// src\Session\Manager.php
// src\Support\Collection.php
// src\Support\helpers.php
// src\Support\ServiceProvider.php
// src\Validation\Rules.php
// src\Validation\Validator.php
// src\View\BladeCompiler.php
// src\View\Factory.php
// src\View\View.php
// app\Controllers\Api\UserController.php
// app\Controllers\AuthController.php
// app\Controllers\Controller.php
// app\Controllers\HomeController.php
// app\Middleware\AuthMiddleware.php
// app\Middleware\CorsMiddleware.php
// app\Middleware\TrimStringsMiddleware.php
// app\Models\Post.php
// app\Models\User.php
// app\Providers\AppServiceProvider.php
// app\Providers\DatabaseServiceProvider.php
// database\migrations\2024_01_01_000000_create_users_table.php
// database\migrations\2024_01_02_000000_create_posts_table.php
// database\seeds\DatabaseSeeder.php
// database\seeds\UserSeeder.php
// index.php
// resources\views\layout.blade.php
// resources\views\welcome.blade.php
// routes\web.php